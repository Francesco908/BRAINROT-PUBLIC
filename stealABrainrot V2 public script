-- SIGMA HUB v3.1 - Enhanced with Persistent Speed & ESP
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- Variables
local deliveryPosition = nil
local isDragging = false
local dragOffset = Vector2.new(0, 0)
local isMinimized = false
local noclipEnabled = false
local noclipConnection = nil
local teleporting = false
local speedEnabled = false
local invisEnabled = false
local espEnabled = false
local currentTab = "Main"
local speedConnection = nil
local espConnection = nil

-- Clean up existing GUI
if PlayerGui:FindFirstChild("SigmaHub") then
    PlayerGui.SigmaHub:Destroy()
end

-- Main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SigmaHub"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Main Frame (movable)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -130)
MainFrame.Size = UDim2.new(0, 350, 0, 280)
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.ClipsDescendants = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(70, 130, 255)
MainStroke.Thickness = 2
MainStroke.Parent = MainFrame

-- Header
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
Header.BorderSizePixel = 0
Header.Size = UDim2.new(1, 0, 0, 35)
Header.Position = UDim2.new(0, 0, 0, 0)

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 12)
HeaderCorner.Parent = Header

local HeaderFix = Instance.new("Frame")
HeaderFix.Parent = Header
HeaderFix.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
HeaderFix.BorderSizePixel = 0
HeaderFix.Size = UDim2.new(1, 0, 0, 12)
HeaderFix.Position = UDim2.new(0, 0, 1, -12)

local Title = Instance.new("TextLabel")
Title.Parent = Header
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 15, 0, 0)
Title.Size = UDim2.new(0, 200, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "‚ö° SIGMA HUB v3.1"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 14
Title.TextXAlignment = Enum.TextXAlignment.Left

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Parent = Header
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 193, 7)
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Position = UDim2.new(1, -60, 0.5, -10)
MinimizeBtn.Size = UDim2.new(0, 20, 0, 20)
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.Text = "‚àí"
MinimizeBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
MinimizeBtn.TextSize = 14

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 4)
MinCorner.Parent = MinimizeBtn

local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = Header
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
CloseBtn.BorderSizePixel = 0
CloseBtn.Position = UDim2.new(1, -35, 0.5, -10)
CloseBtn.Size = UDim2.new(0, 20, 0, 20)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "√ó"
CloseBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
CloseBtn.TextSize = 12

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 4)
CloseCorner.Parent = CloseBtn

-- Tab System
local TabContainer = Instance.new("Frame")
TabContainer.Parent = MainFrame
TabContainer.BackgroundTransparency = 1
TabContainer.Position = UDim2.new(0, 10, 0, 45)
TabContainer.Size = UDim2.new(1, -20, 0, 30)

local tabs = {"Main", "Teleport", "Player", "Visual"}
local tabButtons = {}
local contentFrames = {}

-- Create tab buttons
for i, tabName in ipairs(tabs) do
    local tabBtn = Instance.new("TextButton")
    tabBtn.Parent = TabContainer
    tabBtn.BackgroundColor3 = (tabName == currentTab) and Color3.fromRGB(70, 130, 255) or Color3.fromRGB(45, 45, 55)
    tabBtn.BorderSizePixel = 0
    tabBtn.Position = UDim2.new((i-1) * 0.25, 2, 0, 0)
    tabBtn.Size = UDim2.new(0.25, -4, 1, 0)
    tabBtn.Font = Enum.Font.Gotham
    tabBtn.Text = tabName
    tabBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabBtn.TextSize = 12
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 6)
    tabCorner.Parent = tabBtn
    
    tabButtons[tabName] = tabBtn
    
    -- Create content frame
    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Parent = MainFrame
    contentFrame.BackgroundTransparency = 1
    contentFrame.Position = UDim2.new(0, 10, 0, 85)
    contentFrame.Size = UDim2.new(1, -20, 1, -115)
    contentFrame.CanvasSize = UDim2.new(0, 0, 0, 400)
    contentFrame.ScrollBarThickness = 4
    contentFrame.ScrollBarImageColor3 = Color3.fromRGB(70, 130, 255)
    contentFrame.Visible = (tabName == currentTab)
    contentFrames[tabName] = contentFrame
end

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Parent = MainFrame
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 10, 1, -25)
StatusLabel.Size = UDim2.new(1, -20, 0, 20)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "‚úÖ Ready to use!"
StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
StatusLabel.TextSize = 11
StatusLabel.TextXAlignment = Enum.TextXAlignment.Center

-- Helper function to create buttons
local function createButton(parent, position, size, text, color)
    local button = Instance.new("TextButton")
    button.Parent = parent
    button.BackgroundColor3 = color or Color3.fromRGB(55, 55, 65)
    button.BorderSizePixel = 0
    button.Position = position
    button.Size = size
    button.Font = Enum.Font.Gotham
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 12
    button.AutoButtonColor = false
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    -- Hover effect
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(70, 130, 255)}):Play()
    end)
    button.MouseLeave:Connect(function()
        if not button:GetAttribute("Active") then
            TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = color or Color3.fromRGB(55, 55, 65)}):Play()
        end
    end)
    
    return button
end

-- Main Tab Content
local MainContent = contentFrames["Main"]
local SetPosBtn = createButton(MainContent, UDim2.new(0, 0, 0, 5), UDim2.new(1, 0, 0, 35), "üìç SET CURRENT POSITION")
local FlyBtn = createButton(MainContent, UDim2.new(0, 0, 0, 45), UDim2.new(1, 0, 0, 35), "üöÄ FLY TO POSITION")
local FindPlotBtn = createButton(MainContent, UDim2.new(0, 0, 0, 85), UDim2.new(1, 0, 0, 35), "üéØ FIND NEAREST PLOT")
local LaserTPBtn = createButton(MainContent, UDim2.new(0, 0, 0, 125), UDim2.new(1, 0, 0, 35), "üî¥ TP TO NEAREST LASER")

-- Teleport Tab Content
local TeleportContent = contentFrames["Teleport"]
local InstantTPBtn = createButton(TeleportContent, UDim2.new(0, 0, 0, 5), UDim2.new(1, 0, 0, 35), "‚ö° INSTANT TELEPORT")
local ForwardTPBtn = createButton(TeleportContent, UDim2.new(0, 0, 0, 45), UDim2.new(1, 0, 0, 35), "‚û°Ô∏è TELEPORT FORWARD")

-- Player Tab Content
local PlayerContent = contentFrames["Player"]
local NoClipBtn = createButton(PlayerContent, UDim2.new(0, 0, 0, 5), UDim2.new(1, 0, 0, 35), "üëª NOCLIP: OFF")
local SpeedBtn = createButton(PlayerContent, UDim2.new(0, 0, 0, 45), UDim2.new(1, 0, 0, 35), "‚ö° SPEED: OFF")
local InvisBtn = createButton(PlayerContent, UDim2.new(0, 0, 0, 85), UDim2.new(1, 0, 0, 35), "üëÅÔ∏è INVISIBLE: OFF")

-- Visual Tab Content
local VisualContent = contentFrames["Visual"]
local ESPBtn = createButton(VisualContent, UDim2.new(0, 0, 0, 5), UDim2.new(1, 0, 0, 35), "üëÄ PLAYER ESP: OFF")

-- Tab switching function
local function switchTab(tabName)
    currentTab = tabName
    for name, frame in pairs(contentFrames) do
        frame.Visible = (name == tabName)
    end
    for name, btn in pairs(tabButtons) do
        local isActive = (name == tabName)
        btn.BackgroundColor3 = isActive and Color3.fromRGB(70, 130, 255) or Color3.fromRGB(45, 45, 55)
    end
end

-- Connect tab buttons
for tabName, button in pairs(tabButtons) do
    button.MouseButton1Click:Connect(function()
        switchTab(tabName)
    end)
end

-- Utility Functions
local function updateStatus(text, color)
    StatusLabel.Text = text
    StatusLabel.TextColor3 = color or Color3.fromRGB(255, 255, 255)
end

-- Persistent Speed System
local function maintainSpeed()
    if speedEnabled then
        local character = Player.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.WalkSpeed ~= 80 then
                humanoid.WalkSpeed = 80
            end
        end
    end
end

-- ESP System
local espBoxes = {}

local function createESP(player)
    if player == Player then return end
    
    local character = player.Character
    if not character then return end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return end
    
    local box = Instance.new("BoxHandleAdornment")
    box.Name = "ESP_" .. player.Name
    box.Parent = rootPart
    box.Size = rootPart.Size
    box.Color3 = Color3.fromRGB(255, 0, 0)
    box.Transparency = 0.5
    box.AlwaysOnTop = true
    box.ZIndex = 5
    box.Adornee = rootPart
    
    local nameLabel = Instance.new("BillboardGui")
    nameLabel.Name = "NameESP"
    nameLabel.Parent = rootPart
    nameLabel.Size = UDim2.new(0, 200, 0, 50)
    nameLabel.Adornee = rootPart
    nameLabel.AlwaysOnTop = true
    
    local textLabel = Instance.new("TextLabel")
    textLabel.Parent = nameLabel
    textLabel.Size = UDim2.new(1, 0, 1, 0)
    textLabel.BackgroundTransparency = 1
    textLabel.Text = player.Name
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextSize = 16
    textLabel.Font = Enum.Font.GothamBold
    textLabel.TextStrokeTransparency = 0
    textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    
    espBoxes[player] = {box, nameLabel}
end

local function removeESP(player)
    if espBoxes[player] then
        for _, item in pairs(espBoxes[player]) do
            if item then item:Destroy() end
        end
        espBoxes[player] = nil
    end
end

local function toggleESP()
    espEnabled = not espEnabled
    ESPBtn.Text = espEnabled and "üëÄ PLAYER ESP: ON" or "üëÄ PLAYER ESP: OFF"
    ESPBtn.BackgroundColor3 = espEnabled and Color3.fromRGB(255, 100, 255) or Color3.fromRGB(55, 55, 65)
    ESPBtn:SetAttribute("Active", espEnabled)
    
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            createESP(player)
        end
        
        espConnection = RunService.Heartbeat:Connect(function()
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= Player and not espBoxes[player] then
                    createESP(player)
                end
            end
        end)
    else
        if espConnection then
            espConnection:Disconnect()
            espConnection = nil
        end
        for player, _ in pairs(espBoxes) do
            removeESP(player)
        end
    end
end

local function findNearestLaser()
    local character = Player.Character
    if not character then return nil end
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return nil end
    
    local nearestLaser = nil
    local shortestDistance = math.huge
    
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj.Name:lower():find("laser") and obj:IsA("BasePart") then
            local distance = (rootPart.Position - obj.Position).Magnitude
            if distance < shortestDistance then
                shortestDistance = distance
                nearestLaser = obj.Position
            end
        end
    end
    return nearestLaser
end

local function findNearestPlot()
    local character = Player.Character
    if not character then return nil end
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return nil end
    
    local nearestPlot = nil
    local shortestDistance = math.huge
    
    for _, obj in pairs(Workspace:GetChildren()) do
        if obj.Name:lower():find("plot") or obj.Name:lower():find("base") then
            local part = obj:FindFirstChildOfClass("Part") or obj:FindFirstChildOfClass("BasePart")
            if part then
                local distance = (rootPart.Position - part.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearestPlot = part.Position + Vector3.new(0, 5, 0)
                end
            end
        end
    end
    return nearestPlot
end

local function bypassTeleport(targetPos)
    if teleporting then return end
    teleporting = true
    
    local character = Player.Character
    if not character then 
        teleporting = false
        return 
    end
    
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then 
        teleporting = false
        return 
    end
    
    updateStatus("üîÑ Bypassing anticheat...", Color3.fromRGB(255, 193, 7))
    
    local originalPos = rootPart.CFrame
    
    -- Multi-step bypass
    rootPart.CFrame = CFrame.new(originalPos.Position + Vector3.new(0, 100, 0))
    wait(0.1)
    rootPart.CFrame = CFrame.new(targetPos + Vector3.new(0, 100, 0))
    wait(0.1)
    rootPart.CFrame = CFrame.new(targetPos)
    
    updateStatus("‚úÖ Teleported successfully!", Color3.fromRGB(100, 255, 100))
    teleporting = false
    
    spawn(function()
        wait(2)
        updateStatus("‚úÖ Ready to use!", Color3.fromRGB(100, 255, 100))
    end)
end

-- Feature Functions
local function setPosition()
    local character = Player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            deliveryPosition = rootPart.Position
            updateStatus("üìç Position saved!", Color3.fromRGB(100, 255, 100))
            spawn(function()
                wait(2)
                updateStatus("‚úÖ Ready to use!", Color3.fromRGB(100, 255, 100))
            end)
        end
    end
end

local function flyToPosition()
    if not deliveryPosition then
        updateStatus("‚ùå No position set!", Color3.fromRGB(255, 100, 100))
        return
    end
    bypassTeleport(deliveryPosition)
end

local function findAndGoToPlot()
    local plotPos = findNearestPlot()
    if plotPos then
        deliveryPosition = plotPos
        bypassTeleport(plotPos)
        updateStatus("üéØ Found and going to plot!", Color3.fromRGB(100, 255, 100))
    else
        updateStatus("‚ùå No plot found!", Color3.fromRGB(255, 100, 100))
    end
end

local function teleportToLaser()
    local laserPos = findNearestLaser()
    if laserPos then
        updateStatus("üî¥ Found laser, teleporting...", Color3.fromRGB(255, 193, 7))
        local character = Player.Character
        if character then
            local rootPart = character:FindFirstChild("HumanoidRootPart")
            if rootPart then
                rootPart.CFrame = CFrame.new(laserPos)
                wait(0.5)
                -- Move forward 2 studs
                local forwardPos = rootPart.Position + rootPart.CFrame.LookVector * 2
                rootPart.CFrame = CFrame.new(forwardPos)
                updateStatus("‚úÖ Teleported to laser!", Color3.fromRGB(100, 255, 100))
            end
        end
    else
        updateStatus("‚ùå No laser found!", Color3.fromRGB(255, 100, 100))
    end
end

local function instantTeleport()
    if not deliveryPosition then
        updateStatus("‚ùå No position set!", Color3.fromRGB(255, 100, 100))
        return
    end
    
    local character = Player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            rootPart.CFrame = CFrame.new(deliveryPosition)
            updateStatus("‚ö° Instant teleport!", Color3.fromRGB(100, 255, 100))
        end
    end
end

local function teleportForward()
    local character = Player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            local forwardPos = rootPart.Position + rootPart.CFrame.LookVector * 20
            rootPart.CFrame = CFrame.new(forwardPos)
            updateStatus("‚û°Ô∏è Moved forward!", Color3.fromRGB(100, 255, 100))
        end
    end
end

local function toggleNoClip()
    noclipEnabled = not noclipEnabled
    NoClipBtn.Text = noclipEnabled and "üëª NOCLIP: ON" or "üëª NOCLIP: OFF"
    NoClipBtn.BackgroundColor3 = noclipEnabled and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(55, 55, 65)
    NoClipBtn:SetAttribute("Active", noclipEnabled)
    
    if noclipEnabled then
        noclipConnection = RunService.Stepped:Connect(function()
            local character = Player.Character
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        part.CanCollide = false
                    end
                end
            end
        end)
    elseif noclipConnection then
        noclipConnection:Disconnect()
        noclipConnection = nil
        local character = Player.Character
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
        end
    end
end

local function toggleSpeed()
    speedEnabled = not speedEnabled
    SpeedBtn.Text = speedEnabled and "‚ö° SPEED: ON" or "‚ö° SPEED: OFF"
    SpeedBtn.BackgroundColor3 = speedEnabled and Color3.fromRGB(255, 193, 7) or Color3.fromRGB(55, 55, 65)
    SpeedBtn:SetAttribute("Active", speedEnabled)
    
    if speedEnabled then
        -- Start persistent speed monitoring
        speedConnection = RunService.Heartbeat:Connect(maintainSpeed)
        maintainSpeed()
    else
        if speedConnection then
            speedConnection:Disconnect()
            speedConnection = nil
        end
        local character = Player.Character
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.WalkSpeed = 16
            end
        end
    end
end

local function toggleInvisibility()
    invisEnabled = not invisEnabled
    InvisBtn.Text = invisEnabled and "üëÅÔ∏è INVISIBLE: ON" or "üëÅÔ∏è INVISIBLE: OFF"
    InvisBtn.BackgroundColor3 = invisEnabled and Color3.fromRGB(140, 0, 255) or Color3.fromRGB(55, 55, 65)
    InvisBtn:SetAttribute("Active", invisEnabled)
    
    local character = Player.Character
    if character then
        for _, part in pairs(character:GetDescendants()) do
            if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                part.Transparency = invisEnabled and 1 or 0
                part.CanCollide = not invisEnabled
            elseif part:IsA("Accessory") then
                local handle = part:FindFirstChild("Handle")
                if handle then
                    handle.Transparency = invisEnabled and 1 or 0
                end
            elseif part:IsA("Decal") or part:IsA("Texture") then
                part.Transparency = invisEnabled and 1 or 0
            end
        end
        
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            local bodyColors = character:FindFirstChildOfClass("BodyColors")
            if bodyColors then
                bodyColors.HeadColor3 = invisEnabled and Color3.new(1, 1, 1) or bodyColors.HeadColor3
                bodyColors.LeftArmColor3 = invisEnabled and Color3.new(1, 1, 1) or bodyColors.LeftArmColor3
                bodyColors.RightArmColor3 = invisEnabled and Color3.new(1, 1, 1) or bodyColors.RightArmColor3
                bodyColors.LeftLegColor3 = invisEnabled and Color3.new(1, 1, 1) or bodyColors.LeftLegColor3
                bodyColors.RightLegColor3 = invisEnabled and Color3.new(1, 1, 1) or bodyColors.RightLegColor3
                bodyColors.TorsoColor3 = invisEnabled and Color3.new(1, 1, 1) or bodyColors.TorsoColor3
            end
        end
    end
end

-- Minimize function
local function toggleMinimize()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.new(0, 350, 0, 35) or UDim2.new(0, 350, 0, 280)
    
    MinimizeBtn.Text = isMinimized and "+" or "‚àí"
    
    local tween = TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {
        Size = targetSize
    })
    tween:Play()
    
    for _, frame in pairs(contentFrames) do
        frame.Visible = not isMinimized and (frame == contentFrames[currentTab])
    end
    TabContainer.Visible = not isMinimized
    StatusLabel.Visible = not isMinimized
end

-- Connect all events
MinimizeBtn.MouseButton1Click:Connect(toggleMinimize)
CloseBtn.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Main tab connections
SetPosBtn.MouseButton1Click:Connect(setPosition)
FlyBtn.MouseButton1Click:Connect(flyToPosition)
FindPlotBtn.MouseButton1Click:Connect(findAndGoToPlot)
LaserTPBtn.MouseButton1Click:Connect(teleportToLaser)

-- Teleport tab connections
InstantTPBtn.MouseButton1Click:Connect(instantTeleport)
ForwardTPBtn.MouseButton1Click:Connect(teleportForward)

-- Player tab connections
NoClipBtn.MouseButton1Click:Connect(toggleNoClip)
SpeedBtn.MouseButton1Click:Connect(toggleSpeed)
InvisBtn.MouseButton1Click:Connect(toggleInvisibility)

-- Visual tab connections
ESPBtn.MouseButton1Click:Connect(toggleESP)

-- Opening animation
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)

local openTween = TweenService:Create(MainFrame, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 350, 0, 280),
    Position = UDim2.new(0.5, -175, 0.5, -140)
})
openTween:Play()

-- Character respawn handling
Player.CharacterAdded:Connect(function()
    wait(1)
    if speedEnabled then
        maintainSpeed()
        speedConnection = RunService.Heartbeat:Connect(maintainSpeed)
    end
    if invisEnabled then
        toggleInvisibility()
        toggleInvisibility()
    end
end)

-- Player events for ESP
Players.PlayerAdded:Connect(function(player)
    if espEnabled then
        player.CharacterAdded:Connect(function()
            wait(1)
            createESP(player)
        end)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    removeESP(player)
end)

print("‚ö° SIGMA HUB v3.1 Enhanced - Loaded successfully!")
updateStatus("‚ö° SIGMA HUB v3.1 Loaded!", Color3.fromRGB(70, 130, 255))
