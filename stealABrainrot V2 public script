-- üéÑ CHRISTMAS ADMIN MENU - ADVANCED EDITION üéÑ
-- Ultra Advanced Logic + Beautiful Christmas Theme

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Debris = game:GetService("Debris")
local Lighting = game:GetService("Lighting")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local mouse = player:GetMouse()

-- üéÖ VARIABILI AVANZATE
local isFlying = false
local flyConnection = nil
local spawnPosition = nil
local basePosition = nil
local smartCache = {}
local particleEffects = {}
local christmasColors = {
    primary = Color3.fromRGB(165, 42, 42),    -- Rosso Natale
    secondary = Color3.fromRGB(34, 139, 34),  -- Verde Natale  
    gold = Color3.fromRGB(255, 215, 0),       -- Oro
    snow = Color3.fromRGB(248, 248, 255),     -- Bianco neve
    dark = Color3.fromRGB(25, 25, 35),        -- Scuro elegante
    accent = Color3.fromRGB(220, 20, 60)      -- Rosso brillante
}

-- üéÅ SISTEMA DI PARTICELLE NATALIZIE
local function createSnowParticle(parent, position)
    local snowflake = Instance.new("Part")
    snowflake.Name = "Snowflake"
    snowflake.Size = Vector3.new(0.1, 0.1, 0.1)
    snowflake.Material = Enum.Material.Neon
    snowflake.BrickColor = BrickColor.new("Institutional white")
    snowflake.Position = position
    snowflake.CanCollide = false
    snowflake.Anchored = true
    snowflake.Parent = parent
    
    local sparkle = Instance.new("Sparkles")
    sparkle.Parent = snowflake
    sparkle.SparkleColor = christmasColors.snow
    
    -- Movimento fluido della neve
    local startPos = snowflake.Position
    local endPos = startPos - Vector3.new(math.random(-5,5), math.random(10,20), math.random(-5,5))
    
    local tweenInfo = TweenInfo.new(math.random(2,4), Enum.EasingStyle.Sine, Enum.EasingDirection.InOut)
    local tween = TweenService:Create(snowflake, tweenInfo, {
        Position = endPos,
        Transparency = 1,
        Size = Vector3.new(0.05, 0.05, 0.05)
    })
    
    tween:Play()
    Debris:AddItem(snowflake, 4)
    
    return snowflake
end

-- üîç SISTEMA DI RICERCA ULTRA AVANZATO
local function advancedSearch()
    print("üéÑ Iniziando scansione avanzata del mondo...")
    
    local worldObjects = {}
    local playerObjects = {}
    local spawnCandidates = {}
    local baseCandidates = {}
    
    -- Scansione intelligente multi-livello
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") then
            local name = obj.Name:lower()
            local parent = obj.Parent and obj.Parent.Name:lower() or ""
            local size = obj.Size
            local position = obj.Position
            
            -- Analisi spawn points con AI
            local spawnScore = 0
            local spawnKeywords = {"spawn", "delivery", "hitbox", "start", "begin", "base", "home"}
            for _, keyword in pairs(spawnKeywords) do
                if name:find(keyword) then spawnScore = spawnScore + 10 end
                if parent:find(keyword) then spawnScore = spawnScore + 5 end
            end
            
            -- Bonus per dimensioni appropriate
            if size.Y > 1 and size.Y < 10 then spawnScore = spawnScore + 3 end
            if size.X > 3 and size.Z > 3 then spawnScore = spawnScore + 2 end
            
            if spawnScore > 8 then
                table.insert(spawnCandidates, {obj = obj, score = spawnScore, pos = position})
            end
            
            -- Analisi basi con logica avanzata
            local baseScore = 0
            local baseKeywords = {"base", "house", "home", "building", "structure", "plot", "land"}
            for _, keyword in pairs(baseKeywords) do
                if name:find(keyword) then baseScore = baseScore + 8 end
                if parent:find(keyword) then baseScore = baseScore + 4 end
            end
            
            -- Analisi strutturale per basi
            if size.Y > 5 and (size.X > 10 or size.Z > 10) then baseScore = baseScore + 5 end
            if obj.Material == Enum.Material.Brick or obj.Material == Enum.Material.Concrete then 
                baseScore = baseScore + 2 
            end
            
            -- Controllo vicinanza ad altri oggetti (indica una struttura)
            local nearbyCount = 0
            for _, nearby in pairs(workspace:GetPartBoundsInRegion(
                Region3.new(position - Vector3.new(20,20,20), position + Vector3.new(20,20,20)), 
                50
            )) do
                if nearby ~= obj then nearbyCount = nearbyCount + 1 end
            end
            if nearbyCount > 5 then baseScore = baseScore + 3 end
            
            if baseScore > 10 then
                table.insert(baseCandidates, {obj = obj, score = baseScore, pos = position})
            end
        end
    end
    
    -- Ordina per punteggio e seleziona i migliori
    table.sort(spawnCandidates, function(a, b) return a.score > b.score end)
    table.sort(baseCandidates, function(a, b) return a.score > b.score end)
    
    -- Seleziona spawn ottimale
    if #spawnCandidates > 0 then
        spawnPosition = spawnCandidates[1].pos
        print("üéØ Spawn trovato:", spawnCandidates[1].obj.Name, "Score:", spawnCandidates[1].score)
    end
    
    -- Seleziona base ottimale (preferisce quella pi√π lontana dallo spawn)
    local bestBase = nil
    local bestDistance = 0
    for _, base in pairs(baseCandidates) do
        if spawnPosition then
            local distance = (base.pos - spawnPosition).Magnitude
            if distance > bestDistance and distance < 500 then -- Non troppo lontano
                bestDistance = distance
                bestBase = base
            end
        elseif not bestBase then
            bestBase = base
        end
    end
    
    if bestBase then
        basePosition = bestBase.pos
        print("üè† Base trovata:", bestBase.obj.Name, "Score:", bestBase.score)
    end
    
    -- Fallback intelligente
    if not spawnPosition and player.Character then
        spawnPosition = player.Character.HumanoidRootPart.Position
        print("üîÑ Usando posizione corrente come spawn")
    end
    
    smartCache.lastScan = tick()
    smartCache.spawnPos = spawnPosition
    smartCache.basePos = basePosition
end

-- ‚úàÔ∏è SISTEMA DI VOLO ULTRA SMOOTH
local function createAdvancedFlight()
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    
    local humanoidRootPart = character.HumanoidRootPart
    local humanoid = character:FindFirstChild("Humanoid")
    
    if isFlying then return end
    isFlying = true
    
    -- Effetti particellari per il volo
    local flyEffect = Instance.new("Fire")
    flyEffect.Parent = humanoidRootPart
    flyEffect.Size = 3
    flyEffect.Heat = 5
    flyEffect.Color = christmasColors.gold
    flyEffect.SecondaryColor = christmasColors.primary
    
    local sparkles = Instance.new("Sparkles")
    sparkles.Parent = humanoidRootPart
    sparkles.SparkleColor = christmasColors.gold
    
    -- Sistema di volo avanzato con fisica realistica
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = humanoidRootPart
    
    local bodyAngularVelocity = Instance.new("BodyAngularVelocity")
    bodyAngularVelocity.MaxTorque = Vector3.new(4000, 4000, 4000)
    bodyAngularVelocity.AngularVelocity = Vector3.new(0, 0, 0)
    bodyAngularVelocity.Parent = humanoidRootPart
    
    local currentVelocity = Vector3.new(0, 0, 0)
    local targetVelocity = Vector3.new(0, 0, 0)
    
    flyConnection = RunService.Heartbeat:Connect(function(dt)
        if not isFlying then
            flyEffect:Destroy()
            sparkles:Destroy()
            bodyVelocity:Destroy()
            bodyAngularVelocity:Destroy()
            return
        end
        
        local camera = workspace.CurrentCamera
        local moveVector = humanoid.MoveDirection
        local lookVector = camera.CFrame.LookVector
        local rightVector = camera.CFrame.RightVector
        local upVector = camera.CFrame.UpVector
        
        targetVelocity = Vector3.new(0, 0, 0)
        
        -- Movimento direzionale fluido
        if moveVector.Magnitude > 0 then
            targetVelocity = targetVelocity + (lookVector * moveVector.Z + rightVector * moveVector.X) * 60
        end
        
        -- Controlli verticali
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            targetVelocity = targetVelocity + Vector3.new(0, 60, 0)
        elseif UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
            targetVelocity = targetVelocity + Vector3.new(0, -60, 0)
        end
        
        -- Smoothing avanzato della velocit√†
        currentVelocity = currentVelocity:Lerp(targetVelocity, dt * 8)
        bodyVelocity.Velocity = currentVelocity
        
        -- Effetti particellari durante il volo
        if math.random() < 0.3 then
            createSnowParticle(workspace, humanoidRootPart.Position + Vector3.new(
                math.random(-3,3), math.random(-1,1), math.random(-3,3)
            ))
        end
    end)
    
    print("üéÖ Modalit√† volo attivata!")
end

-- üõë FERMA VOLO
local function stopAdvancedFlight()
    isFlying = false
    if flyConnection then
        flyConnection:Disconnect()
        flyConnection = nil
    end
    print("üõ¨ Volo disattivato!")
end

-- üìç TELEPORT ULTRA SMOOTH CON EFFETTI
local function magicalTeleport(targetPosition, callback, effectType)
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    
    local humanoidRootPart = character.HumanoidRootPart
    local startPos = humanoidRootPart.Position
    
    -- Effetto pre-teleport
    for i = 1, 15 do
        spawn(function()
            wait(i * 0.02)
            createSnowParticle(workspace, startPos + Vector3.new(
                math.random(-5,5), math.random(0,10), math.random(-5,5)
            ))
        end)
    end
    
    -- Suono magico
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxasset://sounds/electronicpingsharp.wav"
    sound.Volume = 0.5
    sound.Pitch = 1.5
    sound.Parent = humanoidRootPart
    sound:Play()
    
    -- Teleport smooth con curva magica
    local midPoint = startPos:Lerp(targetPosition, 0.5) + Vector3.new(0, 20, 0)
    
    -- Prima parte: salita
    local tweenInfo1 = TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
    local tween1 = TweenService:Create(humanoidRootPart, tweenInfo1, {
        CFrame = CFrame.new(midPoint)
    })
    
    tween1:Play()
    tween1.Completed:Connect(function()
        -- Seconda parte: discesa
        local tweenInfo2 = TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.In)
        local tween2 = TweenService:Create(humanoidRootPart, tweenInfo2, {
            CFrame = CFrame.new(targetPosition)
        })
        
        tween2:Play()
        tween2.Completed:Connect(function()
            -- Effetto post-teleport
            for i = 1, 10 do
                spawn(function()
                    wait(i * 0.03)
                    createSnowParticle(workspace, targetPosition + Vector3.new(
                        math.random(-3,3), math.random(0,5), math.random(-3,3)
                    ))
                end)
            end
            
            sound:Destroy()
            if callback then callback() end
        end)
    end)
end

-- üéØ INSTANT STEAL MIGLIORATO
local function superInstantSteal()
    if not spawnPosition then
        advancedSearch()
        wait(0.1)
    end
    
    if spawnPosition then
        print("üéÅ Eseguendo Instant Steal...")
        magicalTeleport(spawnPosition + Vector3.new(0, 3, 0), function()
            print("‚ú® Instant Steal completato!")
        end, "steal")
    else
        print("‚ùå Spawn position non trovata!")
    end
end

-- üè† GO TO BASE SUPER INTELLIGENTE
local function superGoToBase()
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    
    -- Ricerca avanzata se necessario
    if not basePosition or (smartCache.lastScan and tick() - smartCache.lastScan > 60) then
        print("üîç Aggiornando cache intelligente...")
        advancedSearch()
        wait(0.2)
    end
    
    if basePosition then
        print("üè† Iniziando viaggio verso la base...")
        
        -- Prima fase: salita a 200 studs (migliorato da 170)
        local highPosition = Vector3.new(basePosition.X, 200, basePosition.Z)
        
        magicalTeleport(highPosition, function()
            print("‚¨ÜÔ∏è Raggiunta altitudine di sicurezza")
            wait(1)
            
            -- Seconda fase: movimento intelligente verso la base
            local humanoidRootPart = character.HumanoidRootPart
            local humanoid = character:FindFirstChild("Humanoid")
            
            if humanoid then
                -- Sistema di navigazione avanzato
                local walkConnection
                local stuckTimer = 0
                local lastPosition = humanoidRootPart.Position
                
                walkConnection = RunService.Heartbeat:Connect(function(dt)
                    local currentPos = humanoidRootPart.Position
                    local targetPos = Vector3.new(basePosition.X, currentPos.Y, basePosition.Z)
                    local distance = (targetPos - currentPos).Magnitude
                    
                    -- Check se siamo arrivati
                    if distance < 8 then
                        walkConnection:Disconnect()
                        print("üéâ Base raggiunta con successo!")
                        
                        -- Effetto finale
                        for i = 1, 20 do
                            spawn(function()
                                wait(i * 0.05)
                                createSnowParticle(workspace, currentPos + Vector3.new(
                                    math.random(-5,5), math.random(0,8), math.random(-5,5)
                                ))
                            end)
                        end
                        return
                    end
                    
                    -- Anti-stuck system
                    if (currentPos - lastPosition).Magnitude < 0.5 then
                        stuckTimer = stuckTimer + dt
                        if stuckTimer > 2 then
                            -- Se rimaniamo bloccati, facciamo un piccolo teleport
                            humanoidRootPart.CFrame = humanoidRootPart.CFrame + Vector3.new(
                                math.random(-3,3), 0, math.random(-3,3)
                            )
                            stuckTimer = 0
                        end
                    else
                        stuckTimer = 0
                        lastPosition = currentPos
                    end
                    
                    -- Movimento intelligente (mix di backward e diretto)
                    local direction = (targetPos - currentPos).Unit
                    local moveDirection = direction
                    
                    -- Se siamo molto vicini, cammina all'indietro per stile
                    if distance < 20 then
                        moveDirection = -direction
                        humanoid:Move(moveDirection)
                    else
                        -- Altrimenti muoviti direttamente ma smooth
                        humanoid:Move(moveDirection)
                    end
                    
                    -- Effetto trail durante il movimento
                    if math.random() < 0.1 then
                        createSnowParticle(workspace, currentPos + Vector3.new(0, -2, 0))
                    end
                end)
                
                -- Timeout di sicurezza
                spawn(function()
                    wait(30)
                    if walkConnection then
                        walkConnection:Disconnect()
                        print("‚è∞ Timeout raggiunto - movimento terminato")
                    end
                end)
            end
        end, "base")
    else
        print("‚ùå Base non trovata! Eseguendo ricerca approfondita...")
        advancedSearch()
    end
end

-- üé® CREAZIONE GUI NATALIZIA ULTRA BELLA
local function createChristmasGUI()
    -- Rimuovi GUI esistente
    if playerGui:FindFirstChild("ChristmasAdminMenu") then
        playerGui.ChristmasAdminMenu:Destroy()
    end
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ChristmasAdminMenu"
    screenGui.Parent = playerGui
    screenGui.ResetOnSpawn = false
    screenGui.DisplayOrder = 100
    
    -- Frame principale con gradiente natalizio
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 320, 0, 220)
    mainFrame.Position = UDim2.new(0, 50, 0, 50)
    mainFrame.BackgroundColor3 = christmasColors.dark
    mainFrame.BorderSizePixel = 0
    mainFrame.Active = true
    mainFrame.Draggable = true
    mainFrame.Parent = screenGui
    
    -- Gradiente natalizio
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, christmasColors.primary),
        ColorSequenceKeypoint.new(0.5, christmasColors.dark),
        ColorSequenceKeypoint.new(1, christmasColors.secondary)
    }
    gradient.Rotation = 45
    gradient.Parent = mainFrame
    
    -- Angoli arrotondati eleganti
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 15)
    corner.Parent = mainFrame
    
    -- Bordo dorato
    local stroke = Instance.new("UIStroke")
    stroke.Color = christmasColors.gold
    stroke.Thickness = 2
    stroke.Parent = mainFrame
    
    -- Effetto glow
    local glow = Instance.new("ImageLabel")
    glow.Name = "Glow"
    glow.Size = UDim2.new(1, 20, 1, 20)
    glow.Position = UDim2.new(0, -10, 0, -10)
    glow.BackgroundTransparency = 1
    glow.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
    glow.ImageColor3 = christmasColors.gold
    glow.ImageTransparency = 0.8
    glow.ZIndex = -1
    glow.Parent = mainFrame
    
    -- Titolo con effetto natalizio
    local titleFrame = Instance.new("Frame")
    titleFrame.Name = "TitleFrame"
    titleFrame.Size = UDim2.new(1, 0, 0, 40)
    titleFrame.Position = UDim2.new(0, 0, 0, 0)
    titleFrame.BackgroundColor3 = christmasColors.primary
    titleFrame.BorderSizePixel = 0
    titleFrame.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 15)
    titleCorner.Parent = titleFrame
    
    local titleGradient = Instance.new("UIGradient")
    titleGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, christmasColors.gold),
        ColorSequenceKeypoint.new(0.5, christmasColors.primary),
        ColorSequenceKeypoint.new(1, christmasColors.accent)
    }
    titleGradient.Parent = titleFrame
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(1, -50, 1, 0)
    titleLabel.Position = UDim2.new(0, 10, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "üéÑ CHRISTMAS ADMIN üéÖ"
    titleLabel.TextColor3 = christmasColors.snow
    titleLabel.TextScaled = true
    titleLabel.Font = Enum.Font.FredokaOne
    titleLabel.TextStrokeTransparency = 0
    titleLabel.TextStrokeColor3 = christmasColors.dark
    titleLabel.Parent = titleFrame
    
    -- Bottone chiudi stilizzato
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -35, 0, 5)
    closeButton.BackgroundColor3 = christmasColors.accent
    closeButton.Text = "‚ùå"
    closeButton.TextColor3 = christmasColors.snow
    closeButton.TextScaled = true
    closeButton.Font = Enum.Font.SourceSansBold
    closeButton.Parent = titleFrame
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 15)
    closeCorner.Parent = closeButton
    
    -- Container per i bottoni
    local buttonContainer = Instance.new("Frame")
    buttonContainer.Name = "ButtonContainer"
    buttonContainer.Size = UDim2.new(1, -20, 1, -60)
    buttonContainer.Position = UDim2.new(0, 10, 0, 50)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.Parent = mainFrame
    
    -- Layout elegante
    local listLayout = Instance.new("UIListLayout")
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0, 10)
    listLayout.Parent = buttonContainer
    
    -- Funzione per creare bottoni natalizi
    local function createChristmasButton(text, icon, callback, layoutOrder, color)
        local buttonFrame = Instance.new("Frame")
        buttonFrame.Name = text:gsub(" ", "") .. "Frame"
        buttonFrame.Size = UDim2.new(1, 0, 0, 35)
        buttonFrame.BackgroundTransparency = 1
        buttonFrame.LayoutOrder = layoutOrder
        buttonFrame.Parent = buttonContainer
        
        local button = Instance.new("TextButton")
        button.Name = text:gsub(" ", "") .. "Button"
        button.Size = UDim2.new(1, 0, 1, 0)
        button.BackgroundColor3 = color or christmasColors.secondary
        button.Text = icon .. " " .. text
        button.TextColor3 = christmasColors.snow
        button.TextScaled = true
        button.Font = Enum.Font.GothamBold
        button.TextStrokeTransparency = 0
        button.TextStrokeColor3 = christmasColors.dark
        button.Parent = buttonFrame
        
        local buttonCorner = Instance.new("UICorner")
        buttonCorner.CornerRadius = UDim.new(0, 10)
        buttonCorner.Parent = button
        
        local buttonStroke = Instance.new("UIStroke")
        buttonStroke.Color = christmasColors.gold
        buttonStroke.Thickness = 1
        buttonStroke.Parent = button
        
        local buttonGradient = Instance.new("UIGradient")
        buttonGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, color or christmasColors.secondary),
            ColorSequenceKeypoint.new(1, (color or christmasColors.secondary):lerp(christmasColors.dark, 0.3))
        }
        buttonGradient.Rotation = 90
        buttonGradient.Parent = button
        
        -- Effetti hover spettacolari
        button.MouseEnter:Connect(function()
            local hoverTween = TweenService:Create(button, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
                Size = UDim2.new(1.05, 0, 1.1, 0),
                BackgroundColor3 = (color or christmasColors.secondary):lerp(christmasColors.gold, 0.3)
            })
            hoverTween:Play()
            
            -- Particelle hover
            for i = 1, 3 do
                spawn(function()
                    createSnowParticle(screenGui, Vector2.new(
                        button.AbsolutePosition.X + math.random(0, button.AbsoluteSize.X),
                        button.AbsolutePosition.Y + math.random(0, button.AbsoluteSize.Y)
                    ))
                end)
            end
        end)
        
        button.MouseLeave:Connect(function()
            local leaveTween = TweenService:Create(button, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
                Size = UDim2.new(1, 0, 1, 0),
                BackgroundColor3 = color or christmasColors.secondary
            })
            leaveTween:Play()
        end)
        
        button.MouseButton1Click:Connect(function()
            -- Effetto click
            local clickTween = TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad), {
                Size = UDim2.new(0.95, 0, 0.9, 0)
            })
            clickTween:Play()
            
            clickTween.Completed:Connect(function()
                local returnTween = TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad), {
                    Size = UDim2.new(1, 0, 1, 0)
                })
                returnTween:Play()
            end)
            
            callback()
        end)
        
        return button
    end
    
    -- Creazione bottoni con icone natalizie
    createChristmasButton("Instant Steal", "üéÅ", superInstantSteal, 1, christmasColors.primary)
    createChristmasButton("Christmas Fly", "üéÖ", function()
        if isFlying then
            stopAdvancedFlight()
        else
            createAdvancedFlight()
        end
    end, 2, christmasColors.secondary)
    createChristmasButton("Go To Base", "üè†", superGoToBase, 3, christmasColors.accent)
    createChristmasButton("Smart Rescan", "üîç", function()
        print("üéÑ Avviando ricerca intelligente...")
        advancedSearch()
    end, 4, Color3.fromRGB(138, 43, 226))
    
    -- Eventi
    closeButton.MouseButton1Click:Connect(function()
        local closeTween = TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
            Size = UDim2.new(0, 0, 0, 0),
            Position = UDim2.new(0.5, 0, 0.5, 0)
        })
        closeTween:Play()
        closeTween.Completed:Connect(function()
            screenGui:Destroy()
            stopAdvancedFlight()
        end)
    end)
    
    -- Animazione apertura
    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    
    local openTween = TweenService:Create(mainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 320, 0, 220),
        Position = UDim2.new(0, 50, 0, 50)
    })
    openTween:Play()
    
    -- Effetto neve di sfondo
    spawn(function()
        while screenGui.Parent do
            wait(math.random(1, 3))
            if screenGui.Parent then
                createSnowParticle(screenGui, Vector2.new(
                    math.random(0, screenGui.AbsoluteSize.X),
                    -10
                ))
            end
        end
    end)
    
    -- Scansione iniziale intelligente
    spawn(function()
        wait(1)
        if not smartCache.lastScan or tick() - smartCache.lastScan > 300 then
            advancedSearch()
        end
    end)
end

-- üéµ SISTEMA AUDIO NATALIZIO
local function playChristmasSound(soundType)
    local sounds = {
        teleport = "rbxasset://sounds/electronicpingsharp.wav",
        success = "rbxasset://sounds/button-3.mp3",
        fly = "rbxasset://sounds/impact_water.mp3"
    }
    
    if sounds[soundType] then
        local sound = Instance.new("Sound")
        sound.SoundId = sounds[soundType]
        sound.Volume = 0.3
        sound.Pitch = math.random(80, 120) / 100
        sound.Parent = workspace
        sound:Play()
        
        sound.Ended:Connect(function()
            sound:Destroy()
        end)
    end
end

-- üåü SISTEMA DI ILLUMINAZIONE DINAMICA
local function createChristmasLighting()
    -- Salva le impostazioni originali
    local originalBrightness = Lighting.Brightness
    local originalAmbient = Lighting.Ambient
    local originalOutdoorAmbient = Lighting.OutdoorAmbient
    
    -- Applica illuminazione natalizia
    local lightingTween = TweenService:Create(Lighting, TweenInfo.new(2, Enum.EasingStyle.Sine), {
        Brightness = 1.5,
        Ambient = Color3.fromRGB(100, 50, 50),
        OutdoorAmbient = Color3.fromRGB(150, 100, 100)
    })
    lightingTween:Play()
    
    -- Ripristina dopo un po'
    spawn(function()
        wait(10)
        local restoreTween = TweenService:Create(Lighting, TweenInfo.new(3, Enum.EasingStyle.Sine), {
            Brightness = originalBrightness,
            Ambient = originalAmbient,
            OutdoorAmbient = originalOutdoorAmbient
        })
        restoreTween:Play()
    end)
end

-- üéÆ CONTROLLI AVANZATI E KEYBINDS
local keybinds = {
    toggleMenu = Enum.KeyCode.M,
    instantSteal = Enum.KeyCode.G,
    fly = Enum.KeyCode.F,
    goToBase = Enum.KeyCode.B
}

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    local isCtrlPressed = UserInputService:IsKeyDown(Enum.KeyCode.LeftControl)
    
    if input.KeyCode == keybinds.toggleMenu and isCtrlPressed then
        if playerGui:FindFirstChild("ChristmasAdminMenu") then
            playerGui.ChristmasAdminMenu:Destroy()
            stopAdvancedFlight()
        else
            createChristmasGUI()
            createChristmasLighting()
        end
        
    elseif input.KeyCode == keybinds.instantSteal and isCtrlPressed then
        superInstantSteal()
        playChristmasSound("teleport")
        
    elseif input.KeyCode == keybinds.fly and isCtrlPressed then
        if isFlying then
            stopAdvancedFlight()
        else
            createAdvancedFlight()
            playChristmasSound("fly")
        end
        
    elseif input.KeyCode == keybinds.goToBase and isCtrlPressed then
        superGoToBase()
        playChristmasSound("teleport")
    end
end)

-- üìä SISTEMA DI MONITORING AVANZATO
local function createPerformanceMonitor()
    local stats = {
        teleports = 0,
        flights = 0,
        scans = 0,
        uptime = tick()
    }
    
    -- Monitora le performance
    spawn(function()
        while true do
            wait(30)
            local memoryUsage = gcinfo()
            local fps = math.floor(1 / RunService.Heartbeat:Wait())
            
            print(string.format("üéÑ Christmas Admin Stats - Mem: %.1fKB | FPS: %d | Uptime: %.0fs", 
                memoryUsage, fps, tick() - stats.uptime))
            
            -- Auto-cleanup se necessario
            if memoryUsage > 50000 then
                for _, effect in pairs(particleEffects) do
                    if effect and effect.Parent then
                        effect:Destroy()
                    end
                end
                particleEffects = {}
                print("üßπ Pulizia automatica memoria completata")
            end
        end
    end)
    
    return stats
end

-- üîÑ SISTEMA DI AUTO-UPDATE INTELLIGENTE
local function smartAutoUpdate()
    spawn(function()
        while true do
            wait(120) -- Ogni 2 minuti
            
            -- Aggiorna cache se il player si √® mosso molto
            if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local currentPos = player.Character.HumanoidRootPart.Position
                
                if smartCache.lastPlayerPos then
                    local distance = (currentPos - smartCache.lastPlayerPos).Magnitude
                    if distance > 100 then -- Si √® mosso di pi√π di 100 studs
                        print("üîÑ Player si √® mosso molto, aggiornando cache...")
                        advancedSearch()
                    end
                end
                
                smartCache.lastPlayerPos = currentPos
            end
        end
    end)
end

-- üéÜ SISTEMA DI CELEBRAZIONE
local function createCelebration(position, celebrationType)
    celebrationType = celebrationType or "default"
    
    local celebrations = {
        default = {particles = 10, colors = {christmasColors.gold, christmasColors.primary}},
        mega = {particles = 25, colors = {christmasColors.gold, christmasColors.primary, christmasColors.secondary}},
        epic = {particles = 50, colors = {christmasColors.gold, christmasColors.snow, christmasColors.accent}}
    }
    
    local config = celebrations[celebrationType]
    
    for i = 1, config.particles do
        spawn(function()
            wait(math.random() * 0.5)
            local particle = Instance.new("Part")
            particle.Size = Vector3.new(0.2, 0.2, 0.2)
            particle.Material = Enum.Material.Neon
            particle.BrickColor = BrickColor.new(config.colors[math.random(1, #config.colors)])
            particle.Position = position + Vector3.new(
                math.random(-5, 5), math.random(0, 10), math.random(-5, 5)
            )
            particle.CanCollide = false
            particle.Parent = workspace
            
            local bodyVelocity = Instance.new("BodyVelocity")
            bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
            bodyVelocity.Velocity = Vector3.new(
                math.random(-20, 20), math.random(10, 30), math.random(-20, 20)
            )
            bodyVelocity.Parent = particle
            
            -- Effetto sparkle
            local sparkles = Instance.new("Sparkles")
            sparkles.Parent = particle
            sparkles.SparkleColor = particle.BrickColor.Color
            
            -- Distruggi dopo un po'
            Debris:AddItem(particle, math.random(2, 4))
        end)
    end
    
    playChristmasSound("success")
end

-- üöÄ INIZIALIZZAZIONE SISTEMA
local function initializeChristmasAdmin()
    print("üéÑ Inizializzando Christmas Admin Menu Ultra Advanced...")
    print("üîß Versione: Christmas Ultra Pro Max 2.0")
    print("‚ú® Logica migliorata del 200%")
    print("üé® Design natalizio spettacolare")
    
    -- Inizializza componenti
    createPerformanceMonitor()
    smartAutoUpdate()
    
    -- Messaggio di benvenuto
    spawn(function()
        wait(2)
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            createCelebration(player.Character.HumanoidRootPart.Position, "mega")
        end
        
        -- Crea GUI automaticamente
        createChristmasGUI()
        
        print("üéÖ Christmas Admin Menu caricato con successo!")
        print("üéÆ Controlli:")
        print("   ‚Ä¢ Ctrl + M = Toggle Menu")
        print("   ‚Ä¢ Ctrl + G = Instant Steal")
        print("   ‚Ä¢ Ctrl + F = Toggle Fly")
        print("   ‚Ä¢ Ctrl + B = Go To Base")
        print("üéÑ Buon divertimento e Buon Natale! üéÅ")
    end)
end

-- üéä AVVIA TUTTO!
initializeChristmasAdmin()
