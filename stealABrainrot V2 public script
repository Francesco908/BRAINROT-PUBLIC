-- SIGMA HUB v2.4 - Optimized Tab Edition

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- Vars
local deliveryPosition = nil
local isDragging = false
local isMinimized = false
local noclipEnabled = false
local speedEnabled = false
local invisEnabled = false
local teleporting = false
local currentTab = "main"

-- Connection Management
local connections = {}
local debounce = {}

local function addConnection(name, connection)
    if connections[name] then
        connections[name]:Disconnect()
    end
    connections[name] = connection
end

local function cleanupConnections()
    for name, connection in pairs(connections) do
        if connection then
            connection:Disconnect()
        end
    end
    connections = {}
end

local function addDebounce(key, func, cooldown)
    return function(...)
        if debounce[key] then return end
        debounce[key] = true
        func(...)
        spawn(function()
            wait(cooldown or 0.5)
            debounce[key] = false
        end)
    end
end

-- Cleanup existing GUI
if PlayerGui:FindFirstChild("SigmaHub") then
    PlayerGui.SigmaHub:Destroy()
end

-- Teleport Screen
local TeleportScreen = Instance.new("ScreenGui")
TeleportScreen.Name = "TeleportScreen"
TeleportScreen.DisplayOrder = 999999999
TeleportScreen.IgnoreGuiInset = true
TeleportScreen.Enabled = false
TeleportScreen.Parent = PlayerGui

local BlackScreen = Instance.new("Frame")
BlackScreen.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
BlackScreen.BorderSizePixel = 0
BlackScreen.Size = UDim2.new(1, 0, 1, 0)
BlackScreen.Parent = TeleportScreen

local TeleportText = Instance.new("TextLabel")
TeleportText.BackgroundTransparency = 1
TeleportText.Position = UDim2.new(0, 0, 0.4, 0)
TeleportText.Size = UDim2.new(1, 0, 0.2, 0)
TeleportText.Font = Enum.Font.GothamBold
TeleportText.Text = "TELEPORTING..."
TeleportText.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportText.TextSize = 32
TeleportText.TextScaled = true
TeleportText.Parent = TeleportScreen

-- BYPASS LOGIC (Optimized)
local function bypassAnticheat(character)
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not humanoid or not rootPart then return false end
    
    local success = pcall(function()
        rootPart.Anchored = true
        humanoid.PlatformStand = true
        humanoid.Sit = true
        humanoid.WalkSpeed = 0
        humanoid.JumpPower = 0
        humanoid.AutoRotate = false
        
        -- Clean existing body movers
        for _, obj in pairs(rootPart:GetChildren()) do
            if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then 
                obj:Destroy() 
            end
        end
        
        -- Add new body movers
        local bv = Instance.new("BodyVelocity")
        bv.MaxForce = Vector3.new(1e8, 1e8, 1e8)
        bv.Velocity = Vector3.new(0, 0, 0)
        bv.Parent = rootPart
        
        local bg = Instance.new("BodyGyro")
        bg.MaxTorque = Vector3.new(1e8, 1e8, 1e8)
        bg.CFrame = rootPart.CFrame
        bg.Parent = rootPart
    end)
    
    return success
end

local function restoreCharacter(character)
    if not character then return end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    
    pcall(function()
        if rootPart then
            rootPart.Anchored = false
            for _, obj in pairs(rootPart:GetChildren()) do
                if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then 
                    obj:Destroy() 
                end
            end
        end
        
        if humanoid then
            humanoid.PlatformStand = false
            humanoid.Sit = false
            humanoid.WalkSpeed = speedEnabled and 85 or 16
            humanoid.JumpPower = 50
            humanoid.AutoRotate = true
        end
    end)
end

-- Main UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SigmaHub"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.BackgroundTransparency = 0
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -250, 0.5, -200)
MainFrame.Size = UDim2.new(0, 500, 0, 400)
MainFrame.Active = true
MainFrame.ClipsDescendants = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 16)
MainCorner.Parent = MainFrame

local Border = Instance.new("UIStroke")
Border.Color = Color3.fromRGB(255, 194, 0)
Border.Thickness = 2
Border.Transparency = 0.2
Border.Parent = MainFrame

-- Header
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Header.BorderSizePixel = 0
Header.Size = UDim2.new(1, 0, 0, 45)
Header.Active = true

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 16)
HeaderCorner.Parent = Header

local Title = Instance.new("TextLabel")
Title.Parent = Header
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 20, 0, 0)
Title.Size = UDim2.new(1, -120, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "‚ö° SIGMA HUB v2.4"
Title.TextColor3 = Color3.fromRGB(255, 194, 0)
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Parent = Header
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 194, 0)
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Position = UDim2.new(1, -80, 0.5, -15)
MinimizeBtn.Size = UDim2.new(0, 30, 0, 30)
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.Text = "‚àí"
MinimizeBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
MinimizeBtn.TextSize = 20
local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 8)
MinCorner.Parent = MinimizeBtn

local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = Header
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 194, 0)
CloseBtn.BorderSizePixel = 0
CloseBtn.Position = UDim2.new(1, -45, 0.5, -15)
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "√ó"
CloseBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
CloseBtn.TextSize = 18
local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseBtn

-- Tab System
local TabContainer = Instance.new("Frame")
TabContainer.Parent = MainFrame
TabContainer.BackgroundTransparency = 1
TabContainer.Position = UDim2.new(0, 0, 0, 50)
TabContainer.Size = UDim2.new(0, 120, 1, -50)

local ContentContainer = Instance.new("Frame")
ContentContainer.Parent = MainFrame
ContentContainer.BackgroundTransparency = 1
ContentContainer.Position = UDim2.new(0, 125, 0, 50)
ContentContainer.Size = UDim2.new(1, -130, 1, -50)

-- Tab Creation Function
local tabs = {}
local tabButtons = {}

local function createTab(name, icon, yPos)
    local tabBtn = Instance.new("TextButton")
    tabBtn.Parent = TabContainer
    tabBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    tabBtn.BorderSizePixel = 0
    tabBtn.Position = UDim2.new(0, 5, 0, yPos)
    tabBtn.Size = UDim2.new(1, -10, 0, 40)
    tabBtn.Font = Enum.Font.GothamBold
    tabBtn.Text = icon .. " " .. name:upper()
    tabBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
    tabBtn.TextSize = 12
    tabBtn.TextXAlignment = Enum.TextXAlignment.Left
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 8)
    tabCorner.Parent = tabBtn
    
    local tabContent = Instance.new("Frame")
    tabContent.Parent = ContentContainer
    tabContent.BackgroundTransparency = 1
    tabContent.Size = UDim2.new(1, 0, 1, 0)
    tabContent.Visible = false
    
    tabs[name] = tabContent
    tabButtons[name] = tabBtn
    
    return tabBtn, tabContent
end

-- Create Tabs
local mainTab, mainContent = createTab("main", "üè†", 5)
local teleportTab, teleportContent = createTab("teleport", "üåÄ", 50)
local playerTab, playerContent = createTab("player", "üë§", 95)
local settingsTab, settingsContent = createTab("settings", "‚öôÔ∏è", 140)

-- Tab Switching Function
local function switchTab(tabName)
    if currentTab == tabName then return end
    
    -- Hide current tab
    if tabs[currentTab] then
        tabs[currentTab].Visible = false
        tabButtons[currentTab].BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        tabButtons[currentTab].TextColor3 = Color3.fromRGB(200, 200, 200)
    end
    
    -- Show new tab
    currentTab = tabName
    tabs[currentTab].Visible = true
    tabButtons[currentTab].BackgroundColor3 = Color3.fromRGB(255, 194, 0)
    tabButtons[currentTab].TextColor3 = Color3.fromRGB(0, 0, 0)
end

-- Button Factory
local function createModernButton(parent, position, size, text, icon)
    local button = Instance.new("TextButton")
    button.Parent = parent
    button.BackgroundColor3 = Color3.fromRGB(255, 194, 0)
    button.BorderSizePixel = 0
    button.Position = position
    button.Size = size
    button.Font = Enum.Font.GothamBold
    button.Text = (icon and icon .. " " or "") .. text
    button.TextColor3 = Color3.fromRGB(0, 0, 0)
    button.TextSize = 14
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = button
    
    -- Hover effect
    button.MouseEnter:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 215, 50)})
        tween:Play()
    end)
    
    button.MouseLeave:Connect(function()
        local tween = TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 194, 0)})
        tween:Play()
    end)
    
    return button
end

-- Status Label Factory
local function createStatusLabel(parent)
    local label = Instance.new("TextLabel")
    label.Parent = parent
    label.BackgroundTransparency = 1
    label.Position = UDim2.new(0, 10, 1, -30)
    label.Size = UDim2.new(1, -20, 0, 25)
    label.Font = Enum.Font.Gotham
    label.Text = "Ready!"
    label.TextColor3 = Color3.fromRGB(255, 194, 0)
    label.TextSize = 12
    label.TextXAlignment = Enum.TextXAlignment.Center
    return label
end

-- MAIN TAB CONTENT
local welcomeLabel = Instance.new("TextLabel")
welcomeLabel.Parent = mainContent
welcomeLabel.BackgroundTransparency = 1
welcomeLabel.Position = UDim2.new(0, 10, 0, 10)
welcomeLabel.Size = UDim2.new(1, -20, 0, 60)
welcomeLabel.Font = Enum.Font.GothamBold
welcomeLabel.Text = "Welcome to SIGMA HUB v2.4\nOptimized Edition"
welcomeLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
welcomeLabel.TextSize = 16
welcomeLabel.TextXAlignment = Enum.TextXAlignment.Center
welcomeLabel.TextYAlignment = Enum.TextYAlignment.Center

local infoLabel = Instance.new("TextLabel")
infoLabel.Parent = mainContent
infoLabel.BackgroundTransparency = 1
infoLabel.Position = UDim2.new(0, 10, 0, 80)
infoLabel.Size = UDim2.new(1, -20, 0, 150)
infoLabel.Font = Enum.Font.Gotham
infoLabel.Text = "Features:\n‚Ä¢ Advanced Teleportation System\n‚Ä¢ Speed Boost (85 WalkSpeed)\n‚Ä¢ NoClip & Invisibility\n‚Ä¢ Optimized Performance\n‚Ä¢ Clean Tab Interface"
infoLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
infoLabel.TextSize = 12
infoLabel.TextXAlignment = Enum.TextXAlignment.Left
infoLabel.TextYAlignment = Enum.TextYAlignment.Top

-- TELEPORT TAB CONTENT
local SetDeliveryBtn = createModernButton(teleportContent, UDim2.new(0, 10, 0, 10), UDim2.new(1, -20, 0, 35), "SET POSITION", "üìç")
local TeleportBtn = createModernButton(teleportContent, UDim2.new(0, 10, 0, 55), UDim2.new(1, -20, 0, 35), "FLY TO POSITION", "üöÄ")
local ForwardBtn = createModernButton(teleportContent, UDim2.new(0, 10, 0, 100), UDim2.new(1, -20, 0, 35), "TP FORWARD", "‚û°Ô∏è")
local BaseTPBtn = createModernButton(teleportContent, UDim2.new(0, 10, 0, 145), UDim2.new(1, -20, 0, 35), "INSTANT TP", "‚ú®")

local teleportStatus = createStatusLabel(teleportContent)

-- PLAYER TAB CONTENT
local SpeedBtn = createModernButton(playerContent, UDim2.new(0, 10, 0, 10), UDim2.new(1, -20, 0, 35), "SUPER SPEED: OFF", "üèÉ‚Äç‚ôÇÔ∏è")
local NoClipBtn = createModernButton(playerContent, UDim2.new(0, 10, 0, 55), UDim2.new(1, -20, 0, 35), "NOCLIP: OFF", "üëª")
local InvisBtn = createModernButton(playerContent, UDim2.new(0, 10, 0, 100), UDim2.new(1, -20, 0, 35), "INVISIBILITY: OFF", "üëÅÔ∏è")

local playerStatus = createStatusLabel(playerContent)

-- SETTINGS TAB CONTENT
local resetBtn = createModernButton(settingsContent, UDim2.new(0, 10, 0, 10), UDim2.new(1, -20, 0, 35), "RESET ALL", "üîÑ")
local aboutLabel = Instance.new("TextLabel")
aboutLabel.Parent = settingsContent
aboutLabel.BackgroundTransparency = 1
aboutLabel.Position = UDim2.new(0, 10, 0, 60)
aboutLabel.Size = UDim2.new(1, -20, 0, 100)
aboutLabel.Font = Enum.Font.Gotham
aboutLabel.Text = "SIGMA HUB v2.4\nOptimized Edition\n\nFeatures optimized performance\nand modern tab interface"
aboutLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
aboutLabel.TextSize = 12
aboutLabel.TextXAlignment = Enum.TextXAlignment.Center

-- TELEPORT FUNCTIONS
local function updateStatus(label, text, color)
    if label and label.Parent then
        label.Text = text
        label.TextColor3 = color or Color3.fromRGB(255, 194, 0)
    end
end

local function flyToDelivery()
    if teleporting or not deliveryPosition then
        updateStatus(teleportStatus, "‚ö†Ô∏è Set a position first!", Color3.fromRGB(255, 193, 7))
        return
    end
    
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    
    teleporting = true
    updateStatus(teleportStatus, "üöÄ Flying to position...", Color3.fromRGB(0, 128, 255))
    
    if not bypassAnticheat(character) then
        teleporting = false
        return
    end
    
    local targetCFrame = CFrame.new(deliveryPosition)
    local tweenInfo = TweenInfo.new(1.5, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut)
    local tween = TweenService:Create(rootPart, tweenInfo, {CFrame = targetCFrame})
    
    tween:Play()
    tween.Completed:Connect(function()
        restoreCharacter(character)
        updateStatus(teleportStatus, "‚úÖ Arrived successfully!", Color3.fromRGB(0, 255, 0))
        spawn(function()
            wait(3)
            updateStatus(teleportStatus, "Ready!")
            teleporting = false
        end)
    end)
end

local function instantTeleport()
    if teleporting or not deliveryPosition then
        updateStatus(teleportStatus, "‚ö†Ô∏è Set a position first!", Color3.fromRGB(255, 193, 7))
        return
    end
    
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    
    teleporting = true
    TeleportScreen.Enabled = true
    updateStatus(teleportStatus, "‚è≥ Instant teleporting...", Color3.fromRGB(255, 215, 0))
    
    spawn(function()
        bypassAnticheat(character)
        wait(1)
        if rootPart and rootPart.Parent then
            rootPart.CFrame = CFrame.new(deliveryPosition)
        end
        wait(1)
        TeleportScreen.Enabled = false
        restoreCharacter(character)
        updateStatus(teleportStatus, "‚úÖ Teleported instantly!", Color3.fromRGB(0, 255, 0))
        wait(3)
        updateStatus(teleportStatus, "Ready!")
        teleporting = false
    end)
end

local function tpForward()
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    
    updateStatus(teleportStatus, "‚û°Ô∏è Teleporting forward...", Color3.fromRGB(0, 128, 255))
    bypassAnticheat(character)
    wait(0.15)
    
    local cf = rootPart.CFrame
    rootPart.CFrame = cf + (cf.LookVector * 5)
    wait(0.3)
    
    restoreCharacter(character)
    updateStatus(teleportStatus, "‚úÖ TP Forward!", Color3.fromRGB(0, 255, 0))
    wait(2)
    updateStatus(teleportStatus, "Ready!")
end

-- PLAYER FUNCTIONS
local function maintainSpeed()
    local character = Player.Character
    if character and speedEnabled then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid and humanoid.WalkSpeed ~= 85 then
            humanoid.WalkSpeed = 85
        end
    end
end

local function toggleSpeed()
    speedEnabled = not speedEnabled
    local character = Player.Character
    if not character then return end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    
    if speedEnabled then
        humanoid.WalkSpeed = 85
        SpeedBtn.Text = "üèÉ‚Äç‚ôÇÔ∏è SUPER SPEED: ON"
        updateStatus(playerStatus, "üèÉ‚Äç‚ôÇÔ∏è SUPER SPEED ACTIVATED!", Color3.fromRGB(255, 20, 147))
        addConnection("speed", RunService.Heartbeat:Connect(maintainSpeed))
    else
        humanoid.WalkSpeed = 16
        SpeedBtn.Text = "üèÉ‚Äç‚ôÇÔ∏è SUPER SPEED: OFF"
        updateStatus(playerStatus, "Speed restored to normal")
        if connections["speed"] then
            connections["speed"]:Disconnect()
            connections["speed"] = nil
        end
    end
    
    wait(2)
    updateStatus(playerStatus, "Ready!")
end

local function toggleNoClip()
    noclipEnabled = not noclipEnabled
    
    if noclipEnabled then
        NoClipBtn.Text = "üëª NOCLIP: ON"
        updateStatus(playerStatus, "üëª NoClip activated!", Color3.fromRGB(0, 255, 0))
        addConnection("noclip", RunService.Heartbeat:Connect(function()
            local character = Player.Character
            if character then
                for _, part in pairs(character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end))
    else
        NoClipBtn.Text = "üëª NOCLIP: OFF"
        updateStatus(playerStatus, "üëª NoClip deactivated!")
        if connections["noclip"] then
            connections["noclip"]:Disconnect()
            connections["noclip"] = nil
        end
        
        local character = Player.Character
        if character then
            wait(0.1)
            for _, part in pairs(character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
    
    wait(2)
    updateStatus(playerStatus, "Ready!")
end

local function toggleInvis()
    invisEnabled = not invisEnabled
    local character = Player.Character
    if not character then return end
    
    for _, v in pairs(character:GetChildren()) do
        if v:IsA("BasePart") then
            v.LocalTransparencyModifier = invisEnabled and 1 or 0
            v.CanCollide = not invisEnabled
        end
        if v:IsA("Accessory") and v:FindFirstChild("Handle") then
            v.Handle.LocalTransparencyModifier = invisEnabled and 1 or 0
            v.Handle.CanCollide = not invisEnabled
        end
    end
    
    local head = character:FindFirstChild("Head")
    if head then
        for _, c in pairs(head:GetChildren()) do
            if c:IsA("BillboardGui") then 
                c.Enabled = not invisEnabled 
            end
        end
    end
    
    InvisBtn.Text = invisEnabled and "üëÅÔ∏è INVISIBILITY: ON" or "üëÅÔ∏è INVISIBILITY: OFF"
    updateStatus(playerStatus, invisEnabled and "üëÅÔ∏è Invisible!" or "üëÅÔ∏è Visible!", invisEnabled and Color3.fromRGB(0, 255, 0) or nil)
    wait(2)
    updateStatus(playerStatus, "Ready!")
end

-- DRAG FUNCTIONALITY
local function enableDragging(frame)
    local dragging = false
    local dragStart = nil
    local startPos = nil
    
    local function updateInput(input)
        if dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
    
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            addConnection("drag", UserInputService.InputChanged:Connect(updateInput))
        end
    end)
    
    Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
            if connections["drag"] then
                connections["drag"]:Disconnect()
                connections["drag"] = nil
            end
        end
    end)
end

-- EVENT CONNECTIONS
-- Tab switching
mainTab.MouseButton1Click:Connect(function() switchTab("main") end)
teleportTab.MouseButton1Click:Connect(function() switchTab("teleport") end)
playerTab.MouseButton1Click:Connect(function() switchTab("player") end)
settingsTab.MouseButton1Click:Connect(function() switchTab("settings") end)

-- Teleport functions
SetDeliveryBtn.MouseButton1Click:Connect(addDebounce("setpos", function()
    local character = Player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
        if rootPart then
            deliveryPosition = rootPart.Position
            updateStatus(teleportStatus, "‚úÖ Position saved!", Color3.fromRGB(0, 255, 0))
            spawn(function()
                wait(2)
                updateStatus(teleportStatus, "Ready!")
            end)
        end
    end
end, 1))

TeleportBtn.MouseButton1Click:Connect(addDebounce("flytp", flyToDelivery, 2))
BaseTPBtn.MouseButton1Click:Connect(addDebounce("instanttp", instantTeleport, 2))
ForwardBtn.MouseButton1Click:Connect(addDebounce("forward", tpForward, 1))

-- Player functions
SpeedBtn.MouseButton1Click:Connect(addDebounce("speed", toggleSpeed, 1))
NoClipBtn.MouseButton1Click:Connect(addDebounce("noclip", toggleNoClip, 1))
InvisBtn.MouseButton1Click:Connect(addDebounce("invis", toggleInvis, 1))

-- Settings
resetBtn.MouseButton1Click:Connect(addDebounce("reset", function()
    -- Reset all features
    if speedEnabled then toggleSpeed() end
    if noclipEnabled then toggleNoClip() end
    if invisEnabled then toggleInvis() end
    deliveryPosition = nil
    updateStatus(teleportStatus, "All features reset!")
    updateStatus(playerStatus, "All features reset!")
end, 2))

-- Window controls
MinimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.new(0, 500, 0, 45) or UDim2.new(0, 500, 0, 400)
    local tween = TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = targetSize})
    tween:Play()
    MinimizeBtn.Text = isMinimized and "+" or "‚àí"
    TabContainer.Visible = not isMinimized
    ContentContainer.Visible = not isMinimized
end)

CloseBtn.MouseButton1Click:Connect(function()
    cleanupConnections()
    teleporting = false
    local tween = TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back), {
        Size = UDim2.new(0, 0, 0, 0), 
        Position = UDim2.new(0.5, 0, 0.5, 0)
    })
    tween:Play()
    tween.Completed:Connect(function()
        if ScreenGui and ScreenGui.Parent then ScreenGui:Destroy() end
        if TeleportScreen and TeleportScreen.Parent then TeleportScreen:Destroy() end
    end)
end)

-- Handle character respawning
Player.CharacterAdded:Connect(function(character)
    if speedEnabled then
        local humanoid = character:WaitForChild("Humanoid")
        wait(0.5)
        humanoid.WalkSpeed = 85
    end
end)

-- Enable dragging
enableDragging(MainFrame)

-- Initialize with main tab
switchTab("main")

-- Startup animation
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
local openTween = TweenService:Create(MainFrame, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 500, 0, 400), 
    Position = UDim2.new(0.5, -250, 0.5, -200)
})
openTween:Play()

-- Success message
print("‚ö° SIGMA HUB v2.4 -! üöÄ‚ú®")
