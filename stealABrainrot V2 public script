-- SIGMA HUB v2.2 - MOD by OnlyRobloxScript

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- Vars
local deliveryPosition = nil
local isDragging = false
local isMinimized = false
local noclipEnabled = false
local noclipConnection = nil
local teleporting = false
local speedEnabled = false
local invisEnabled = false

if PlayerGui:FindFirstChild("SigmaHub") then
    PlayerGui.SigmaHub:Destroy()
end

-- Teleport Screen
local TeleportScreen = Instance.new("ScreenGui")
TeleportScreen.Name = "TeleportScreen"
TeleportScreen.DisplayOrder = 999999999
TeleportScreen.IgnoreGuiInset = true
TeleportScreen.Enabled = false
TeleportScreen.Parent = PlayerGui

local BlackScreen = Instance.new("Frame")
BlackScreen.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
BlackScreen.BorderSizePixel = 0
BlackScreen.Size = UDim2.new(1, 0, 1, 0)
BlackScreen.Parent = TeleportScreen

local TeleportText = Instance.new("TextLabel")
TeleportText.BackgroundTransparency = 1
TeleportText.Position = UDim2.new(0, 0, 0.4, 0)
TeleportText.Size = UDim2.new(1, 0, 0.2, 0)
TeleportText.Font = Enum.Font.GothamBold
TeleportText.Text = "TELEPORTING..."
TeleportText.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportText.TextSize = 32
TeleportText.TextScaled = true
TeleportText.Parent = TeleportScreen

-- Bypass Logic
local function bypassAnticheat(character)
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not humanoid or not rootPart then return false end
    pcall(function()
        rootPart.Anchored = true
        humanoid.PlatformStand = true
        humanoid.Sit = true
        humanoid.WalkSpeed = 0
        humanoid.JumpPower = 0
        humanoid.AutoRotate = false
        for _,obj in pairs(rootPart:GetChildren()) do
            if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
        end
        local bv = Instance.new("BodyVelocity")
        bv.MaxForce = Vector3.new(1e8, 1e8, 1e8)
        bv.Velocity = Vector3.new(0, 0, 0)
        bv.Parent = rootPart
        local bg = Instance.new("BodyGyro")
        bg.MaxTorque = Vector3.new(1e8,1e8,1e8)
        bg.CFrame = rootPart.CFrame
        bg.Parent = rootPart
    end)
    return true
end

local function restoreCharacter(character)
    if not character then return end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    pcall(function()
        if rootPart then
            rootPart.Anchored = false
            for _,obj in pairs(rootPart:GetChildren()) do
                if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
            end
        end
        if humanoid then
            humanoid.PlatformStand = false
            humanoid.Sit = false
            humanoid.WalkSpeed = 16
            humanoid.JumpPower = 50
            humanoid.AutoRotate = true
        end
    end)
end

local function findNearestPlot()
    local character = Player.Character
    if not character then return nil end
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return nil end
    local nearestPlot = nil
    local shortestDistance = math.huge
    for _, obj in pairs(Workspace:GetChildren()) do
        if obj.Name:lower():find("plot") then
            local basePart = obj:FindFirstChildOfClass("BasePart")
            if basePart then
                local distance = (rootPart.Position - basePart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearestPlot = basePart.Position
                end
            end
        end
    end
    return nearestPlot
end

-- UI principale (con sidebar)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SigmaHub"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.BackgroundTransparency = 0
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -225, 0.5, -190)
MainFrame.Size = UDim2.new(0, 450, 0, 380)
MainFrame.Active = true
MainFrame.ClipsDescendants = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 16)
MainCorner.Parent = MainFrame

local Border = Instance.new("UIStroke")
Border.Color = Color3.fromRGB(255,255,255)
Border.Thickness = 2
Border.Transparency = 0.2
Border.Parent = MainFrame

-- Sidebar Tabs
local Sidebar = Instance.new("Frame")
Sidebar.Name = "Sidebar"
Sidebar.Parent = MainFrame
Sidebar.BackgroundColor3 = Color3.fromRGB(20,20,20)
Sidebar.Size = UDim2.new(0,90,1,0)
Sidebar.Position = UDim2.new(0,0,0,0)

local tabs = {"Main", "Teleport", "Utility", "Visual"}
local tabButtons = {}
local selectedTab = "Main"

for i, tabName in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Name = tabName.."_Tab"
    btn.Parent = Sidebar
    btn.BackgroundColor3 = Color3.fromRGB(33,33,33)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, 5, 0, 15 + ((i-1)*45))
    btn.Size = UDim2.new(0, 80, 0, 40)
    btn.Font = Enum.Font.GothamBold
    btn.Text = tabName
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.TextSize = 17
    btn.AutoButtonColor = true
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = btn
    tabButtons[tabName] = btn
end

-- Header
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Header.BorderSizePixel = 0
Header.Size = UDim2.new(1, 0, 0, 40)
Header.Position = UDim2.new(0, 0, 0, 0)
Header.Active = true

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 16)
HeaderCorner.Parent = Header

local Title = Instance.new("TextLabel")
Title.Parent = Header
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 110, 0, 0)
Title.Size = UDim2.new(0, 260, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "⚡ SIGMA HUB"
Title.TextColor3 = Color3.fromRGB(255,255,255)
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Parent = Header
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Position = UDim2.new(1, -70, 0.5, -12)
MinimizeBtn.Size = UDim2.new(0, 24, 0, 24)
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.Text = "−"
MinimizeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeBtn.TextSize = 18
local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 6)
MinCorner.Parent = MinimizeBtn

local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = Header
CloseBtn.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
CloseBtn.BorderSizePixel = 0
CloseBtn.Position = UDim2.new(1, -40, 0.5, -12)
CloseBtn.Size = UDim2.new(0, 24, 0, 24)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "×"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 16
local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseBtn

-- Content area (multi-tab)
local ContentFrames = {}
for _, tabName in ipairs(tabs) do
    local frame = Instance.new("Frame")
    frame.Name = tabName.."Frame"
    frame.Parent = MainFrame
    frame.BackgroundTransparency = 1
    frame.Position = UDim2.new(0, 100, 0, 45)
    frame.Size = UDim2.new(1, -110, 1, -55)
    frame.Visible = (tabName == selectedTab)
    ContentFrames[tabName] = frame
end

local function selectTab(tabName)
    selectedTab = tabName
    for t, frame in pairs(ContentFrames) do
        frame.Visible = (t == tabName)
    end
end
for tab, btn in pairs(tabButtons) do
    btn.MouseButton1Click:Connect(function() selectTab(tab) end)
end

-- Main tab bottoni
local function createModernButton(parent, position, size, text, icon)
    local button = Instance.new("TextButton")
    button.Parent = parent
    button.BackgroundColor3 = Color3.fromRGB(0,0,0)
    button.BorderSizePixel = 0
    button.Position = position
    button.Size = size
    button.Font = Enum.Font.GothamBold
    button.Text = icon .. " " .. text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 14
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = button
    return button
end

-- Aggiungi i bottoni che già avevi nel tab appropriato
local MainContent = ContentFrames["Main"]
local SetDeliveryBtn = createModernButton(MainContent, UDim2.new(0.05, 0, 0.03, 0), UDim2.new(0.9, 0, 0, 32), "SET POSITION", "📍")
local TeleportBtn   = createModernButton(MainContent, UDim2.new(0.05, 0, 0.13, 0), UDim2.new(0.9, 0, 0, 32), "FLY TO POSITION", "🌀")
local ForwardBtn    = createModernButton(MainContent, UDim2.new(0.05, 0, 0.23, 0), UDim2.new(0.9, 0, 0, 32), "TP FORWARD (bypass)", "➡️")
local NearestBaseBtn= createModernButton(MainContent, UDim2.new(0.05, 0, 0.33, 0), UDim2.new(0.9, 0, 0, 32), "NEAREST PLOT", "🎯")

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Parent = MainContent
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0.05, 0, 0.85, 0)
StatusLabel.Size = UDim2.new(0.9, 0, 0, 25)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Ready to teleport!"
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
StatusLabel.TextSize = 11
StatusLabel.TextXAlignment = Enum.TextXAlignment.Center

-- Utility tab bottoni
local UtilityContent = ContentFrames["Utility"]
local NoClipBtn     = createModernButton(UtilityContent, UDim2.new(0.05, 0, 0.03, 0), UDim2.new(0.9, 0, 0, 32), "NOCLIP: OFF", "👻")
local SpeedBtn      = createModernButton(UtilityContent, UDim2.new(0.05, 0, 0.13, 0), UDim2.new(0.9, 0, 0, 32), "SPEED BOOST: OFF", "⚡")
local InvisBtn      = createModernButton(UtilityContent, UDim2.new(0.05, 0, 0.23, 0), UDim2.new(0.9, 0, 0, 32), "INVISIBILITY: OFF", "👁️")

-- Teleport tab bottoni
local TeleportContent = ContentFrames["Teleport"]
local BaseTPBtn     = createModernButton(TeleportContent, UDim2.new(0.05, 0, 0.03, 0), UDim2.new(0.9, 0, 0, 32), "INSTANT TP", "✨")

-- Visual tab (esempio puoi aggiungere altro)
local VisualContent = ContentFrames["Visual"]
local VisualLabel = Instance.new("TextLabel")
VisualLabel.Parent = VisualContent
VisualLabel.BackgroundTransparency = 1
VisualLabel.Position = UDim2.new(0.2, 0, 0.2, 0)
VisualLabel.Size = UDim2.new(0.6, 0, 0.08, 0)
VisualLabel.Font = Enum.Font.GothamBold
VisualLabel.Text = "Visual settings coming soon!"
VisualLabel.TextColor3 = Color3.fromRGB(255,255,255)
VisualLabel.TextSize = 17
VisualLabel.TextXAlignment = Enum.TextXAlignment.Center

-- FLY TO POSITION (Fly a y=170, cammina veloce all'indietro verso la base, poi tippa a y=-70 e ritorna normale)
local function flyToDeliveryBypass()
    if teleporting then return end
    if not deliveryPosition then
        StatusLabel.Text = "⚠️ Set a position first!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 193, 7)
        return
    end
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    teleporting = true
    StatusLabel.Text = "🛫 Anticheat Bypass Step 1..."
    StatusLabel.TextColor3 = Color3.fromRGB(255, 128, 0)
    if not bypassAnticheat(character) then
        teleporting = false
        return
    end

    -- Step 1: vola su a y=170
    local initialPos = rootPart.Position
    local highTarget = Vector3.new(initialPos.X, 170, initialPos.Z)
    rootPart.CFrame = CFrame.new(highTarget)
    wait(0.25)

    -- Step 2: cammina veloce all'indietro verso la base a y=170
    StatusLabel.Text = "🛬 Walking in air, bypassing..."
    StatusLabel.TextColor3 = Color3.fromRGB(0, 128, 255)
    local baseTarget = Vector3.new(deliveryPosition.X, 170, deliveryPosition.Z)
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if humanoid then humanoid.WalkSpeed = 70 end
    local duration = ((highTarget - baseTarget).Magnitude) / 70
    local startTime = tick()
    while tick()-startTime < duration do
        rootPart.CFrame = rootPart.CFrame:Lerp(CFrame.new(baseTarget), 0.2)
        RunService.RenderStepped:Wait()
    end
    rootPart.CFrame = CFrame.new(baseTarget)
    wait(0.2)

    -- Step 3: tippa a y=-70 per pulire l'anticheat
    StatusLabel.Text = "🌑 Teleport down, finishing..."
    StatusLabel.TextColor3 = Color3.fromRGB(255, 0, 128)
    rootPart.CFrame = CFrame.new(baseTarget.X, -70, baseTarget.Z)
    wait(0.18)

    -- Step 4: ritorna normale alla base (deliveryPosition)
    StatusLabel.Text = "✅ Done! Restoring..."
    StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
    rootPart.CFrame = CFrame.new(deliveryPosition)
    if humanoid then humanoid.WalkSpeed = 16 end
    restoreCharacter(character)
    wait(0.3)
    StatusLabel.Text = "Ready to teleport!"
    StatusLabel.TextColor3 = Color3.fromRGB(255,255,255)
    teleporting = false
end

-- EVENTI
SetDeliveryBtn.MouseButton1Click:Connect(function()
    local character = Player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
        if rootPart then
            deliveryPosition = rootPart.Position
            StatusLabel.Text = "✅ Position saved!"
            StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
            spawn(function()
                wait(2)
                if StatusLabel and StatusLabel.Parent then
                    StatusLabel.Text = "Ready to teleport!"
                    StatusLabel.TextColor3 = Color3.fromRGB(255,255,255)
                end
            end)
        end
    end
end)
TeleportBtn.MouseButton1Click:Connect(flyToDeliveryBypass)
BaseTPBtn.MouseButton1Click:Connect(function()
    -- (usa la tua funzione instantTeleport originale)
end)
NearestBaseBtn.MouseButton1Click:Connect(function()
    -- (usa la tua funzione teleportToNearestPlot originale)
end)
NoClipBtn.MouseButton1Click:Connect(function()
    -- (usa la tua funzione toggleNoClip originale)
end)
SpeedBtn.MouseButton1Click:Connect(function()
    -- (usa la tua funzione toggleSpeed originale)
end)
InvisBtn.MouseButton1Click:Connect(function()
    -- (usa la tua funzione toggleInvis originale)
end)
ForwardBtn.MouseButton1Click:Connect(function()
    -- (usa la tua funzione tpForward originale)
end)

-- Minimizza/chiudi/drag come già avevi

-- Startup animation
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
local openTween = TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 450, 0, 380), Position = UDim2.new(0.5, -225, 0.5, -190)
})
openTween:Play()

print("⚡ SIGMA HUB v2.2 - MOD Copilot: Sidebar tab, fly bypass anticheat potenziato!")
