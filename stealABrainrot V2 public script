-- Admin vs Admin Script by Znfpro
-- Fixed & Improved with Anti-Cheat Bypass

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- Wait for character
local function getCharacter()
    return player.Character or player.CharacterAdded:Wait()
end

local character = getCharacter()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- Variables
local basePosition = Vector3.new(0, 5, 0)
local stealActive = false
local speedBoostActive = false
local gui = nil

-- Anti-Cheat Bypass System
local originalCFrame = rootPart.CFrame
local connections = {}

local function enableAntiCheatBypass()
    -- Block all position resets
    local oldIndex
    oldIndex = hookmetamethod(game, "__index", function(self, key)
        if key == "CFrame" and self == rootPart then
            return originalCFrame
        end
        return oldIndex(self, key)
    end)
    
    -- Disable all anchoring attempts
    rootPart.Changed:Connect(function(property)
        if property == "Anchored" and rootPart.Anchored then
            rootPart.Anchored = false
        end
    end)
end

-- Create GUI
local function createGUI()
    if gui then gui:Destroy() end
    
    gui = Instance.new("ScreenGui")
    gui.Name = "AdminVsAdminGUI"
    gui.ResetOnSpawn = false
    gui.Parent = player.PlayerGui
    
    return gui
end

-- Startup sequence
local function showStartup()
    local gui = createGUI()
    
    local startupFrame = Instance.new("Frame")
    startupFrame.Size = UDim2.new(1, 0, 1, 0)
    startupFrame.Position = UDim2.new(0, 0, 0, 0)
    startupFrame.BackgroundColor3 = Color3.new(0, 0, 0)
    startupFrame.BackgroundTransparency = 0.5
    startupFrame.Parent = gui
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(0, 400, 0, 100)
    titleLabel.Position = UDim2.new(0.5, -200, 0.5, -50)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "Made by Znfpro"
    titleLabel.TextColor3 = Color3.new(1, 1, 1)
    titleLabel.TextScaled = true
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Parent = startupFrame
    
    -- Play music
    spawn(function()
        local sound = Instance.new("Sound")
        sound.SoundId = "rbxassetid://76714680193450"
        sound.Volume = 0.3
        sound.Looped = true
        sound.Parent = workspace
        pcall(function() sound:Play() end)
    end)
    
    wait(3)
    startupFrame:Destroy()
end

-- Notification system
local function notify(text, color, duration)
    local gui = player.PlayerGui:FindFirstChild("AdminVsAdminGUI")
    if not gui then return end
    
    local notification = Instance.new("Frame")
    notification.Size = UDim2.new(0, 250, 0, 60)
    notification.Position = UDim2.new(0.5, -125, 0, 20)
    notification.BackgroundColor3 = color or Color3.new(0, 0, 0)
    notification.BorderSizePixel = 0
    notification.Parent = gui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = notification
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.new(1, 1, 1)
    label.TextScaled = true
    label.Font = Enum.Font.Gotham
    label.Parent = notification
    
    game:GetService("Debris"):AddItem(notification, duration or 3)
end

-- Create draggable button
local function createButton(text, position, callback)
    local gui = player.PlayerGui:FindFirstChild("AdminVsAdminGUI")
    if not gui then gui = createGUI() end
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 160, 0, 50)
    button.Position = position
    button.BackgroundColor3 = Color3.new(0, 0, 0)
    button.BorderSizePixel = 0
    button.Text = text
    button.TextColor3 = Color3.new(1, 1, 1)
    button.TextScaled = true
    button.Font = Enum.Font.GothamBold
    button.Parent = gui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = button
    
    -- Dragging
    local dragging = false
    
    button.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            local startPos = input.Position
            local startGui = button.Position
            
            local dragConnection
            dragConnection = mouse.Move:Connect(function()
                if dragging then
                    local delta = mouse.Hit.Position - startPos
                    button.Position = UDim2.new(startGui.X.Scale, startGui.X.Offset + mouse.X - startPos.X, startGui.Y.Scale, startGui.Y.Offset + mouse.Y - startPos.Y)
                end
            end)
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    dragConnection:Disconnect()
                end
            end)
        end
    end)
    
    button.MouseButton1Click:Connect(callback)
    return button
end

-- Enhanced movement with anti-cheat bypass
local function bypassMove(targetPos, speed)
    spawn(function()
        enableAntiCheatBypass()
        
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.Parent = rootPart
        
        local direction = (targetPos - rootPart.Position).Unit
        local distance = (targetPos - rootPart.Position).Magnitude
        
        for i = 1, distance / speed do
            if not rootPart.Parent then break end
            rootPart.CFrame = rootPart.CFrame + direction * speed
            originalCFrame = rootPart.CFrame
            wait(0.03)
        end
        
        bodyVelocity:Destroy()
    end)
end

-- Super jump with bypass
local function superJump()
    spawn(function()
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(0, math.huge, 0)
        bodyVelocity.Velocity = Vector3.new(0, 100, 0)
        bodyVelocity.Parent = rootPart
        
        wait(0.5)
        bodyVelocity:Destroy()
    end)
end

-- Steal Rainbow function
local function stealRainbow()
    if stealActive then return end
    stealActive = true
    
    notify("Set Base", Color3.new(1, 1, 0), 2)
    basePosition = rootPart.Position
    wait(1)
    
    notify("Steal!", Color3.new(0, 1, 0), 2)
    
    -- Move backward
    local backPos = rootPart.Position - rootPart.CFrame.LookVector * 30
    bypassMove(backPos, 3)
    wait(2)
    
    -- Move to base with jumps
    spawn(function()
        while (rootPart.Position - basePosition).Magnitude > 10 and stealActive do
            local direction = (basePosition - rootPart.Position).Unit
            local nextPos = rootPart.Position + direction * 5
            
            bypassMove(nextPos, 2)
            wait(0.5)
            superJump()
            wait(1.5)
        end
        
        if stealActive then
            notify("Steal Complete!", Color3.new(0, 1, 0), 3)
            stealActive = false
        end
    end)
end

-- Speed boost function
local function toggleSpeedBoost()
    speedBoostActive = not speedBoostActive
    
    if speedBoostActive then
        local speedCoil = player.Backpack:FindFirstChild("Speed Coil")
        if speedCoil then
            humanoid:EquipTool(speedCoil)
            notify("Speed Boost ON", Color3.new(0, 1, 0), 2)
            
            -- Keep equipped forever
            spawn(function()
                while speedBoostActive do
                    local equippedTool = character:FindFirstChildOfClass("Tool")
                    if not equippedTool or equippedTool.Name ~= "Speed Coil" then
                        local newCoil = player.Backpack:FindFirstChild("Speed Coil")
                        if newCoil then
                            humanoid:EquipTool(newCoil)
                        end
                    end
                    wait(0.1)
                end
            end)
        else
            notify("Speed Coil Not Found!", Color3.new(1, 0, 0), 3)
            speedBoostActive = false
        end
    else
        notify("Speed Boost OFF", Color3.new(1, 1, 0), 2)
    end
end

-- Initialize
spawn(function()
    showStartup()
    
    local stealButton = createButton("Steal Rainbow", UDim2.new(0, 20, 0, 100), stealRainbow)
    local speedButton = createButton("Speed Boost", UDim2.new(0, 20, 0, 160), toggleSpeedBoost)
    
    -- Update speed button color
    spawn(function()
        while wait(0.1) do
            if speedButton then
                speedButton.BackgroundColor3 = speedBoostActive and Color3.new(0, 0.6, 0) or Color3.new(0, 0, 0)
            end
        end
    end)
end)

-- Handle respawn
player.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoid = character:WaitForChild("Humanoid") 
    rootPart = character:WaitForChild("HumanoidRootPart")
    originalCFrame = rootPart.CFrame
    stealActive = false
    speedBoostActive = false
end)
