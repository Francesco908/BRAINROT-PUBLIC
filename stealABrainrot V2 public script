-- Advanced Roblox Teleport & Jump System
-- Ottimizzato per performance e funzionalitÃ  avanzate

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local character = player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- Variabili globali del sistema
local AdvancedTPSystem = {
    basePosition = nil,
    isJumping = false,
    isFloating = false,
    jumpConnection = nil,
    floatConnection = nil,
    gui = nil,
    tabOpen = false,
    jumpPower = 50,
    floatHeight = 16,
    safetyChecks = true,
    antiKick = true,
    smartPath = true
}

-- Funzione per creare l'interfaccia GUI avanzata
local function createAdvancedGUI()
    -- Rimuovi GUI esistente se presente
    if AdvancedTPSystem.gui then
        AdvancedTPSystem.gui:Destroy()
    end
    
    -- Crea ScreenGui principale
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "AdvancedTPSystem"
    screenGui.Parent = playerGui
    screenGui.ResetOnSpawn = false
    
    -- Frame principale (nascosto inizialmente)
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 300, 0, 400)
    mainFrame.Position = UDim2.new(1, -320, 0.5, -200)
    mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    mainFrame.BorderSizePixel = 0
    mainFrame.Visible = false
    mainFrame.Parent = screenGui
    
    -- Effetto arrotondato
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    -- Effetto ombra
    local shadow = Instance.new("Frame")
    shadow.Name = "Shadow"
    shadow.Size = UDim2.new(1, 6, 1, 6)
    shadow.Position = UDim2.new(0, -3, 0, -3)
    shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    shadow.BackgroundTransparency = 0.7
    shadow.ZIndex = mainFrame.ZIndex - 1
    shadow.Parent = mainFrame
    
    local shadowCorner = Instance.new("UICorner")
    shadowCorner.CornerRadius = UDim.new(0, 12)
    shadowCorner.Parent = shadow
    
    -- Titolo
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(1, 0, 0, 50)
    titleLabel.Position = UDim2.new(0, 0, 0, 0)
    titleLabel.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    titleLabel.BorderSizePixel = 0
    titleLabel.Text = "ðŸš€ Advanced TP System"
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextScaled = true
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = titleLabel
    
    -- Container per i pulsanti
    local buttonContainer = Instance.new("ScrollingFrame")
    buttonContainer.Name = "ButtonContainer"
    buttonContainer.Size = UDim2.new(1, -20, 1, -70)
    buttonContainer.Position = UDim2.new(0, 10, 0, 60)
    buttonContainer.BackgroundTransparency = 1
    buttonContainer.BorderSizePixel = 0
    buttonContainer.ScrollBarThickness = 8
    buttonContainer.Parent = mainFrame
    
    -- Layout per i pulsanti
    local listLayout = Instance.new("UIListLayout")
    listLayout.SortOrder = Enum.SortOrder.LayoutOrder
    listLayout.Padding = UDim.new(0, 10)
    listLayout.Parent = buttonContainer
    
    -- Funzione per creare pulsanti avanzati
    local function createButton(text, color, callback, layoutOrder)
        local button = Instance.new("TextButton")
        button.Name = text:gsub(" ", "")
        button.Size = UDim2.new(1, 0, 0, 50)
        button.BackgroundColor3 = color
        button.BorderSizePixel = 0
        button.Text = text
        button.TextColor3 = Color3.fromRGB(255, 255, 255)
        button.TextScaled = true
        button.Font = Enum.Font.Gotham
        button.LayoutOrder = layoutOrder
        button.Parent = buttonContainer
        
        local buttonCorner = Instance.new("UICorner")
        buttonCorner.CornerRadius = UDim.new(0, 8)
        buttonCorner.Parent = button
        
        -- Effetti hover
        button.MouseEnter:Connect(function()
            local tween = TweenService:Create(button, TweenInfo.new(0.2), {
                BackgroundColor3 = Color3.new(color.R + 0.1, color.G + 0.1, color.B + 0.1)
            })
            tween:Play()
        end)
        
        button.MouseLeave:Connect(function()
            local tween = TweenService:Create(button, TweenInfo.new(0.2), {
                BackgroundColor3 = color
            })
            tween:Play()
        end)
        
        button.MouseButton1Click:Connect(callback)
        
        return button
    end
    
    -- Pulsante Tab per aprire/chiudere
    local tabButton = Instance.new("TextButton")
    tabButton.Name = "TabButton"
    tabButton.Size = UDim2.new(0, 60, 0, 30)
    tabButton.Position = UDim2.new(1, -80, 0.5, -15)
    tabButton.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
    tabButton.BorderSizePixel = 0
    tabButton.Text = "TAB"
    tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabButton.TextScaled = true
    tabButton.Font = Enum.Font.GothamBold
    tabButton.Parent = screenGui
    
    local tabCorner = Instance.new("UICorner")
    tabCorner.CornerRadius = UDim.new(0, 8)
    tabCorner.Parent = tabButton
    
    -- Pulsanti principali
    createButton("ðŸ“ Set Base Position", Color3.fromRGB(50, 150, 50), function()
        AdvancedTPSystem.basePosition = rootPart.Position
        game.StarterGui:SetCore("SendNotification", {
            Title = "Base Set!";
            Text = "Position saved: " .. tostring(AdvancedTPSystem.basePosition);
            Duration = 3;
        })
    end, 1)
    
    createButton("âš¡ Instant TP to Base", Color3.fromRGB(150, 50, 50), function()
        if AdvancedTPSystem.basePosition then
            instantTeleport()
        else
            game.StarterGui:SetCore("SendNotification", {
                Title = "Error";
                Text = "Base position not set!";
                Duration = 3;
            })
        end
    end, 2)
    
    createButton("ðŸ¦˜ Smart Jump to Base", Color3.fromRGB(50, 100, 200), function()
        if AdvancedTPSystem.basePosition then
            startSmartJump()
        else
            game.StarterGui:SetCore("SendNotification", {
                Title = "Error";
                Text = "Base position not set!";
                Duration = 3;
            })
        end
    end, 3)
    
    createButton("ðŸŽˆ Toggle Float Mode", Color3.fromRGB(150, 100, 50), function()
        toggleFloat()
    end, 4)
    
    createButton("âš™ï¸ Jump Power: " .. AdvancedTPSystem.jumpPower, Color3.fromRGB(100, 100, 100), function()
        AdvancedTPSystem.jumpPower = AdvancedTPSystem.jumpPower == 50 and 100 or 50
        game.StarterGui:SetCore("SendNotification", {
            Title = "Jump Power";
            Text = "Set to: " .. AdvancedTPSystem.jumpPower;
            Duration = 2;
        })
    end, 5)
    
    createButton("ðŸ›¡ï¸ Toggle Safety", Color3.fromRGB(100, 50, 150), function()
        AdvancedTPSystem.safetyChecks = not AdvancedTPSystem.safetyChecks
        game.StarterGui:SetCore("SendNotification", {
            Title = "Safety Mode";
            Text = AdvancedTPSystem.safetyChecks and "Enabled" or "Disabled";
            Duration = 2;
        })
    end, 6)
    
    -- Funzione toggle Tab
    local function toggleTab()
        AdvancedTPSystem.tabOpen = not AdvancedTPSystem.tabOpen
        
        local targetPos = AdvancedTPSystem.tabOpen and 
            UDim2.new(1, -320, 0.5, -200) or 
            UDim2.new(1, 20, 0.5, -200)
        
        local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {
            Position = targetPos
        })
        tween:Play()
        
        mainFrame.Visible = true
        tabButton.Text = AdvancedTPSystem.tabOpen and "â®" or "TAB"
    end
    
    tabButton.MouseButton1Click:Connect(toggleTab)
    
    AdvancedTPSystem.gui = screenGui
end

-- Funzione teleport istantaneo avanzato
function instantTeleport()
    if not AdvancedTPSystem.basePosition then return end
    
    local safePosition = AdvancedTPSystem.basePosition + Vector3.new(0, 5, 0)
    
    if AdvancedTPSystem.safetyChecks then
        -- Controlli di sicurezza
        local raycast = workspace:Raycast(safePosition, Vector3.new(0, -10, 0))
        if raycast then
            safePosition = raycast.Position + Vector3.new(0, 3, 0)
        end
    end
    
    -- Teleport con effetto
    local originalCFrame = rootPart.CFrame
    rootPart.CFrame = CFrame.new(safePosition)
    
    -- Effetto particelle (se disponibile)
    spawn(function()
        for i = 1, 10 do
            local effect = Instance.new("Explosion")
            effect.Position = safePosition
            effect.BlastRadius = 0
            effect.BlastPressure = 0
            effect.Visible = false
            effect.Parent = workspace
            wait(0.1)
        end
    end)
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "Teleported!";
        Text = "Arrived at base instantly";
        Duration = 2;
    })
end

-- Sistema di jump intelligente avanzato
function startSmartJump()
    if AdvancedTPSystem.isJumping then
        stopSmartJump()
        return
    end
    
    AdvancedTPSystem.isJumping = true
    
    local function calculateDirection()
        local currentPos = rootPart.Position
        local targetPos = AdvancedTPSystem.basePosition
        local direction = (targetPos - currentPos).Unit
        
        -- Aggiungi componente verticale se necessario
        if (targetPos - currentPos).Magnitude > 50 then
            direction = direction + Vector3.new(0, 0.3, 0)
        end
        
        return direction
    end
    
    local function performSmartJump()
        if not AdvancedTPSystem.isJumping then return end
        
        local distance = (AdvancedTPSystem.basePosition - rootPart.Position).Magnitude
        
        -- Se siamo vicini alla base, fermati
        if distance < 10 then
            stopSmartJump()
            instantTeleport() -- Teleport finale preciso
            return
        end
        
        -- Calcola direzione intelligente
        local direction = calculateDirection()
        
        -- Jump con direzione
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
        bodyVelocity.Velocity = direction * AdvancedTPSystem.jumpPower
        bodyVelocity.Parent = rootPart
        
        -- Rimuovi velocity dopo un momento
        spawn(function()
            wait(0.5)
            if bodyVelocity then
                bodyVelocity:Destroy()
            end
        end)
        
        -- Movimento all'indietro prima del jump (per evitare detection)
        spawn(function()
            wait(0.1)
            local backwardVelocity = Instance.new("BodyVelocity")
            backwardVelocity.MaxForce = Vector3.new(4000, 0, 4000)
            backwardVelocity.Velocity = -direction * 10
            backwardVelocity.Parent = rootPart
            
            wait(0.2)
            if backwardVelocity then
                backwardVelocity:Destroy()
            end
        end)
    end
    
    -- Connessione al loop principale
    AdvancedTPSystem.jumpConnection = RunService.Heartbeat:Connect(function()
        if not AdvancedTPSystem.isJumping then return end
        
        -- Controlla se il player Ã¨ a terra per il prossimo jump
        local raycast = workspace:Raycast(rootPart.Position, Vector3.new(0, -5, 0))
        if raycast then
            wait(0.3) -- Pausa tra jumps
            performSmartJump()
        end
    end)
    
    -- Primo jump
    performSmartJump()
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "Smart Jump Started!";
        Text = "Jumping to base automatically";
        Duration = 2;
    })
end

function stopSmartJump()
    AdvancedTPSystem.isJumping = false
    if AdvancedTPSystem.jumpConnection then
        AdvancedTPSystem.jumpConnection:Disconnect()
        AdvancedTPSystem.jumpConnection = nil
    end
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "Smart Jump Stopped";
        Text = "Manual control restored";
        Duration = 2;
    })
end

-- Sistema di float avanzato
function toggleFloat()
    AdvancedTPSystem.isFloating = not AdvancedTPSystem.isFloating
    
    if AdvancedTPSystem.isFloating then
        startFloat()
    else
        stopFloat()
    end
end

function startFloat()
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.MaxForce = Vector3.new(0, math.huge, 0)
    bodyPosition.Position = rootPart.Position + Vector3.new(0, AdvancedTPSystem.floatHeight, 0)
    bodyPosition.Parent = rootPart
    
    AdvancedTPSystem.floatConnection = RunService.Heartbeat:Connect(function()
        if not AdvancedTPSystem.isFloating then return end
        bodyPosition.Position = rootPart.Position + Vector3.new(0, AdvancedTPSystem.floatHeight, 0)
    end)
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "Float Mode ON";
        Text = "Flying at " .. AdvancedTPSystem.floatHeight .. " studs high";
        Duration = 2;
    })
end

function stopFloat()
    if AdvancedTPSystem.floatConnection then
        AdvancedTPSystem.floatConnection:Disconnect()
        AdvancedTPSystem.floatConnection = nil
    end
    
    -- Rimuovi BodyPosition
    for _, obj in pairs(rootPart:GetChildren()) do
        if obj:IsA("BodyPosition") then
            obj:Destroy()
        end
    end
    
    game.StarterGui:SetCore("SendNotification", {
        Title = "Float Mode OFF";
        Text = "Gravity restored";
        Duration = 2;
    })
end

-- Controlli da tastiera avanzati
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.Tab then
        if AdvancedTPSystem.gui then
            -- Toggle della GUI
            local mainFrame = AdvancedTPSystem.gui:FindFirstChild("MainFrame")
            if mainFrame then
                AdvancedTPSystem.tabOpen = not AdvancedTPSystem.tabOpen
                
                local targetPos = AdvancedTPSystem.tabOpen and 
                    UDim2.new(1, -320, 0.5, -200) or 
                    UDim2.new(1, 20, 0.5, -200)
                
                local tween = TweenService:Create(mainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quart), {
                    Position = targetPos
                })
                tween:Play()
                
                mainFrame.Visible = true
                local tabButton = AdvancedTPSystem.gui:FindFirstChild("TabButton")
                if tabButton then
                    tabButton.Text = AdvancedTPSystem.tabOpen and "â®" or "TAB"
                end
            end
        end
    elseif input.KeyCode == Enum.KeyCode.T then
        -- Teleport rapido
        if AdvancedTPSystem.basePosition then
            instantTeleport()
        end
    elseif input.KeyCode == Enum.KeyCode.J then
        -- Jump intelligente
        if AdvancedTPSystem.basePosition then
            startSmartJump()
        end
    elseif input.KeyCode == Enum.KeyCode.F then
        -- Float toggle
        toggleFloat()
    end
end)

-- Sistema anti-kick avanzato
if AdvancedTPSystem.antiKick then
    spawn(function()
        while wait(1) do
            -- Simula attivitÃ  umana
            if math.random(1, 100) == 1 then
                humanoid:MoveTo(rootPart.Position + Vector3.new(math.random(-1, 1), 0, math.random(-1, 1)))
            end
        end
    end)
end

-- Gestione riconnessione character
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoid = character:WaitForChild("Humanoid")
    rootPart = character:WaitForChild("HumanoidRootPart")
    
    -- Ricrea GUI
    wait(1)
    createAdvancedGUI()
end)

-- Inicializzazione
createAdvancedGUI()

game.StarterGui:SetCore("SendNotification", {
    Title = "Advanced TP System Loaded!";
    Text = "Press TAB to open menu | T=Teleport | J=Jump | F=Float";
    Duration = 5;
})

print("ðŸš€ Advanced Roblox TP System caricato con successo!")
print("ðŸ“‹ Comandi:")
print("   TAB - Apri/Chiudi menu")
print("   T - Teleport istantaneo")
print("   J - Jump intelligente")
print("   F - Toggle float")
print("ðŸ’¡ Usa i pulsanti nella GUI per funzioni avanzate!")
