-- Advanced Teleport System per Roblox
-- Sistema anti-detection con movimento naturale

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- Variabili globali
local basePosition = nil
local isMoving = false
local gui = nil

-- Configurazione movimento
local MOVE_HEIGHT = 50 -- Altezza di volo
local MOVE_SPEED = 16 -- Velocità movimento
local STEP_DISTANCE = 20 -- Distanza per ogni "passo"
local HOVER_TIME = 0.1 -- Tempo di hover tra i movimenti
local ANTI_DETECT_DELAY = 0.05 -- Delay anti-detection

-- Funzione per creare la GUI
local function createGUI()
    -- Rimuovi GUI esistente se presente
    if gui then
        gui:Destroy()
    end
    
    -- Crea ScreenGui principale
    gui = Instance.new("ScreenGui")
    gui.Name = "AdvancedTPSystem"
    gui.ResetOnSpawn = false
    gui.Parent = player:WaitForChild("PlayerGui")
    
    -- Frame principale
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 200, 0, 120)
    mainFrame.Position = UDim2.new(1, -220, 0.5, -60)
    mainFrame.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = gui
    
    -- Corner radius
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = mainFrame
    
    -- Titolo
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, 0, 0, 30)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "Advanced TP System"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextScaled = true
    title.Font = Enum.Font.GothamBold
    title.Parent = mainFrame
    
    -- Pulsante Set Position
    local setPositionBtn = Instance.new("TextButton")
    setPositionBtn.Name = "SetPositionBtn"
    setPositionBtn.Size = UDim2.new(1, -20, 0, 30)
    setPositionBtn.Position = UDim2.new(0, 10, 0, 40)
    setPositionBtn.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    setPositionBtn.BorderSizePixel = 0
    setPositionBtn.Text = "Set Base Position"
    setPositionBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    setPositionBtn.TextScaled = true
    setPositionBtn.Font = Enum.Font.Gotham
    setPositionBtn.Parent = mainFrame
    
    local setCorner = Instance.new("UICorner")
    setCorner.CornerRadius = UDim.new(0, 6)
    setCorner.Parent = setPositionBtn
    
    -- Pulsante TP to Base
    local tpToBaseBtn = Instance.new("TextButton")
    tpToBaseBtn.Name = "TPToBaseBtn"
    tpToBaseBtn.Size = UDim2.new(1, -20, 0, 30)
    tpToBaseBtn.Position = UDim2.new(0, 10, 0, 80)
    tpToBaseBtn.BackgroundColor3 = Color3.fromRGB(255, 87, 87)
    tpToBaseBtn.BorderSizePixel = 0
    tpToBaseBtn.Text = "TP to Base"
    tpToBaseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    tpToBaseBtn.TextScaled = true
    tpToBaseBtn.Font = Enum.Font.Gotham
    tpToBaseBtn.Parent = mainFrame
    
    local tpCorner = Instance.new("UICorner")
    tpCorner.CornerRadius = UDim.new(0, 6)
    tpCorner.Parent = tpToBaseBtn
    
    -- Status indicator
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Name = "StatusLabel"
    statusLabel.Size = UDim2.new(1, 0, 0, 15)
    statusLabel.Position = UDim2.new(0, 0, 1, -15)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = "Ready"
    statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    statusLabel.TextScaled = true
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.Parent = mainFrame
    
    return setPositionBtn, tpToBaseBtn, statusLabel
end

-- Funzione per creare un BodyVelocity temporaneo
local function createBodyVelocity(velocity)
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
    bodyVelocity.Velocity = velocity
    bodyVelocity.Parent = rootPart
    return bodyVelocity
end

-- Funzione per movimento fluido con anti-detection
local function smoothMove(targetPosition, callback)
    if isMoving then return end
    isMoving = true
    
    local startPosition = rootPart.Position
    local distance = (targetPosition - startPosition).Magnitude
    local direction = (targetPosition - startPosition).Unit
    
    -- Calcola il numero di passi necessari
    local steps = math.ceil(distance / STEP_DISTANCE)
    local currentStep = 0
    
    -- Disabilita temporaneamente la gravità
    local bodyPosition = Instance.new("BodyPosition")
    bodyPosition.MaxForce = Vector3.new(4000, 4000, 4000)
    bodyPosition.Position = startPosition
    bodyPosition.Parent = rootPart
    
    -- Funzione ricorsiva per movimento step-by-step
    local function moveStep()
        currentStep = currentStep + 1
        
        if currentStep > steps then
            -- Movimento completato
            bodyPosition:Destroy()
            isMoving = false
            if callback then callback() end
            return
        end
        
        -- Calcola la prossima posizione
        local progress = currentStep / steps
        local nextPos
        
        if currentStep < steps then
            nextPos = startPosition + (direction * STEP_DISTANCE * currentStep)
            nextPos = Vector3.new(nextPos.X, MOVE_HEIGHT, nextPos.Z)
        else
            nextPos = targetPosition
        end
        
        -- Applica movimento graduale
        bodyPosition.Position = nextPos
        
        -- Anti-detection: piccola pausa casuale
        wait(ANTI_DETECT_DELAY + math.random() * 0.02)
        
        -- Continua con il prossimo passo
        moveStep()
    end
    
    -- Inizia il movimento
    moveStep()
end

-- Funzione per il teleport avanzato alla base
local function advancedTPToBase()
    if not basePosition or isMoving then 
        return 
    end
    
    local statusLabel = gui.MainFrame.StatusLabel
    statusLabel.Text = "Moving to base..."
    statusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
    
    -- Step 1: Vai in alto
    local currentPos = rootPart.Position
    local highPosition = Vector3.new(currentPos.X, MOVE_HEIGHT, currentPos.Z)
    
    smoothMove(highPosition, function()
        wait(HOVER_TIME)
        
        -- Step 2: Movimento verso la base con pattern anti-detection
        local baseHigh = Vector3.new(basePosition.X, MOVE_HEIGHT, basePosition.Z)
        
        smoothMove(baseHigh, function()
            wait(HOVER_TIME)
            
            -- Step 3: Scendi alla base
            smoothMove(basePosition, function()
                statusLabel.Text = "Arrived at base!"
                statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                
                wait(2)
                statusLabel.Text = "Ready"
            end)
        end)
    end)
end

-- Funzione per settare la posizione base
local function setBasePosition()
    basePosition = rootPart.Position
    local statusLabel = gui.MainFrame.StatusLabel
    statusLabel.Text = "Base position set!"
    statusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
    
    wait(2)
    statusLabel.Text = "Ready"
end

-- Funzione principale di inizializzazione
local function initialize()
    -- Aggiorna character e componenti quando il player respawna
    local function updateCharacter()
        character = player.Character or player.CharacterAdded:Wait()
        humanoid = character:WaitForChild("Humanoid")
        rootPart = character:WaitForChild("HumanoidRootPart")
    end
    
    player.CharacterAdded:Connect(updateCharacter)
    
    -- Crea GUI
    local setBtn, tpBtn, statusLabel = createGUI()
    
    -- Connetti eventi
    setBtn.Activated:Connect(function()
        if not isMoving then
            setBasePosition()
        end
    end)
    
    tpBtn.Activated:Connect(function()
        if not isMoving then
            advancedTPToBase()
        end
    end)
    
    -- Effetti hover per i pulsanti
    setBtn.MouseEnter:Connect(function()
        setBtn.BackgroundColor3 = Color3.fromRGB(0, 142, 235)
    end)
    
    setBtn.MouseLeave:Connect(function()
        setBtn.BackgroundColor3 = Color3.fromRGB(0, 162, 255)
    end)
    
    tpBtn.MouseEnter:Connect(function()
        tpBtn.BackgroundColor3 = Color3.fromRGB(235, 67, 67)
    end)
    
    tpBtn.MouseLeave:Connect(function()
        tpBtn.BackgroundColor3 = Color3.fromRGB(255, 87, 87)
    end)
    
    print("Advanced TP System inizializzato!")
end

-- Avvia il sistema
initialize()

-- Comando per rimuovere il sistema (opzionale)
game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.Delete then
        if gui then
            gui:Destroy()
            print("Advanced TP System rimosso!")
        end
    end
end)
