-- RUBBA BRAINROT GUI - Sistema Perfetto con Bypass!

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- Variabili globali
local deliveryPosition = nil
local isDragging = false
local isMinimized = false
local noclipEnabled = false
local noclipConnection = nil
local teleporting = false

-- Distruggi GUI esistente
if PlayerGui:FindFirstChild("BrainrotGUI") then
    PlayerGui.BrainrotGUI:Destroy()
end

-- TELEPORT SCREEN
local TeleportScreen = Instance.new("ScreenGui")
TeleportScreen.Name = "TeleportScreen"
TeleportScreen.DisplayOrder = 999999999
TeleportScreen.IgnoreGuiInset = true
TeleportScreen.Enabled = false
TeleportScreen.Parent = PlayerGui

local BlackScreen = Instance.new("Frame")
BlackScreen.Name = "BlackScreen"
BlackScreen.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
BlackScreen.BorderSizePixel = 0
BlackScreen.Size = UDim2.new(1, 0, 1, 0)
BlackScreen.Parent = TeleportScreen

local TeleportText = Instance.new("TextLabel")
TeleportText.Name = "TeleportText"
TeleportText.BackgroundTransparency = 1
TeleportText.Position = UDim2.new(0, 0, 0.4, 0)
TeleportText.Size = UDim2.new(1, 0, 0.2, 0)
TeleportText.Font = Enum.Font.GothamBold
TeleportText.Text = "TELEPORTING..."
TeleportText.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportText.TextSize = 32
TeleportText.Parent = TeleportScreen

-- BYPASS FUNCTIONS
local function bypassAnticheat(character)
    if not character then return nil end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local root = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not root then return nil end
    
    local originalProperties = {
        gravity = workspace.Gravity,
        walkSpeed = humanoid.WalkSpeed,
        jumpPower = humanoid.JumpPower,
        hipHeight = humanoid.HipHeight,
        collisionType = root.CanCollide,
        velocity = root.Velocity,
        cframe = root.CFrame
    }
    
    workspace.Gravity = 0
    humanoid.WalkSpeed = 0
    humanoid.JumpPower = 0
    humanoid.HipHeight = 0
    root.CanCollide = false
    root.Velocity = Vector3.new(0, 0, 0)
    
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
            part.Velocity = Vector3.new(0, 0, 0)
            part.RotVelocity = Vector3.new(0, 0, 0)
        end
    end
    
    return originalProperties
end

local function restoreCharacter(character, originalProperties)
    if not character or not originalProperties then return end
    
    local humanoid = character:FindFirstChild("Humanoid")
    local root = character:FindFirstChild("HumanoidRootPart")
    if not humanoid or not root then return end
    
    workspace.Gravity = originalProperties.gravity
    humanoid.WalkSpeed = originalProperties.walkSpeed
    humanoid.JumpPower = originalProperties.jumpPower
    humanoid.HipHeight = originalProperties.hipHeight
    root.CanCollide = originalProperties.collisionType
    
    for _, part in pairs(character:GetDescendants()) do
        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
            part.CanCollide = true
        end
    end
end

-- Crea ScreenGui principale
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BrainrotGUI"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

-- Frame principale
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -100)
MainFrame.Size = UDim2.new(0, 350, 0, 200)
MainFrame.Active = true
MainFrame.ClipsDescendants = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local Border = Instance.new("UIStroke")
Border.Color = Color3.fromRGB(70, 130, 255)
Border.Thickness = 2
Border.Transparency = 0.3
Border.Parent = MainFrame

-- Header
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
Header.BorderSizePixel = 0
Header.Size = UDim2.new(1, 0, 0, 35)

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 12)
HeaderCorner.Parent = Header

local HeaderFix = Instance.new("Frame")
HeaderFix.Parent = Header
HeaderFix.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
HeaderFix.BorderSizePixel = 0
HeaderFix.Position = UDim2.new(0, 0, 0.7, 0)
HeaderFix.Size = UDim2.new(1, 0, 0.3, 0)

-- Titolo
local Title = Instance.new("TextLabel")
Title.Parent = Header
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 15, 0, 0)
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "üß† RUBBA BRAINROT PRO"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 14
Title.TextXAlignment = Enum.TextXAlignment.Left

-- Minimizza
local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Parent = Header
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Position = UDim2.new(1, -60, 0.5, -10)
MinimizeBtn.Size = UDim2.new(0, 20, 0, 20)
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.Text = "‚àí"
MinimizeBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
MinimizeBtn.TextSize = 16

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 4)
MinCorner.Parent = MinimizeBtn

-- Chiudi
local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = Header
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
CloseBtn.BorderSizePixel = 0
CloseBtn.Position = UDim2.new(1, -35, 0.5, -10)
CloseBtn.Size = UDim2.new(0, 20, 0, 20)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "√ó"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 16

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 4)
CloseCorner.Parent = CloseBtn

-- Contenuto
local Content = Instance.new("Frame")
Content.Parent = MainFrame
Content.BackgroundTransparency = 1
Content.Position = UDim2.new(0, 0, 0, 40)
Content.Size = UDim2.new(1, 0, 1, -40)

-- Pulsante Set Delivery Point
local SetDeliveryBtn = Instance.new("TextButton")
SetDeliveryBtn.Parent = Content
SetDeliveryBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
SetDeliveryBtn.BorderSizePixel = 0
SetDeliveryBtn.Position = UDim2.new(0.05, 0, 0.05, 0)
SetDeliveryBtn.Size = UDim2.new(0.9, 0, 0, 35)
SetDeliveryBtn.Font = Enum.Font.GothamBold
SetDeliveryBtn.Text = "üìç SET DELIVERY POINT"
SetDeliveryBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
SetDeliveryBtn.TextSize = 12

local DeliveryCorner = Instance.new("UICorner")
DeliveryCorner.CornerRadius = UDim.new(0, 8)
DeliveryCorner.Parent = SetDeliveryBtn

-- Pulsante Flying Teleport
local TeleportBtn = Instance.new("TextButton")
TeleportBtn.Parent = Content
TeleportBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
TeleportBtn.BorderSizePixel = 0
TeleportBtn.Position = UDim2.new(0.05, 0, 0.3, 0)
TeleportBtn.Size = UDim2.new(0.9, 0, 0, 35)
TeleportBtn.Font = Enum.Font.GothamBold
TeleportBtn.Text = "üåÄ FLY TO DELIVERY"
TeleportBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportBtn.TextSize = 12

local TeleCorner = Instance.new("UICorner")
TeleCorner.CornerRadius = UDim.new(0, 8)
TeleCorner.Parent = TeleportBtn

-- Pulsante NoClip
local NoClipBtn = Instance.new("TextButton")
NoClipBtn.Parent = Content
NoClipBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 200)
NoClipBtn.BorderSizePixel = 0
NoClipBtn.Position = UDim2.new(0.05, 0, 0.55, 0)
NoClipBtn.Size = UDim2.new(0.9, 0, 0, 35)
NoClipBtn.Font = Enum.Font.GothamBold
NoClipBtn.Text = "üëª NOCLIP: OFF"
NoClipBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
NoClipBtn.TextSize = 12

local NoClipCorner = Instance.new("UICorner")
NoClipCorner.CornerRadius = UDim.new(0, 8)
NoClipCorner.Parent = NoClipBtn

-- Pulsante TP TO BASE
local BaseTPBtn = Instance.new("TextButton")
BaseTPBtn.Parent = Content
BaseTPBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
BaseTPBtn.BorderSizePixel = 0
BaseTPBtn.Position = UDim2.new(0.05, 0, 0.8, 0)
BaseTPBtn.Size = UDim2.new(0.9, 0, 0, 35)
BaseTPBtn.Font = Enum.Font.GothamBold
BaseTPBtn.Text = "‚ö° TP TO BASE"
BaseTPBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
BaseTPBtn.TextSize = 12

local BaseTPCorner = Instance.new("UICorner")
BaseTPCorner.CornerRadius = UDim.new(0, 8)
BaseTPCorner.Parent = BaseTPBtn

-- FUNZIONI DI TELEPORT
local function flyToDelivery()
    if teleporting then return end
    
    if not deliveryPosition then
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 50)
        TeleportBtn.Text = "‚ö†Ô∏è SET DELIVERY FIRST"
        spawn(function()
            wait(1)
            if TeleportBtn and TeleportBtn.Parent then
                TeleportBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
                TeleportBtn.Text = "üåÄ FLY TO DELIVERY"
            end
        end)
        return
    end
    
    local character = Player.Character
    if not character then return end
    
    teleporting = true
    TeleportBtn.Text = "üöÄ FLYING..."
    
    local originalProperties = bypassAnticheat(character)
    if not originalProperties then 
        teleporting = false
        return 
    end
    
    local root = character:FindFirstChild("HumanoidRootPart")
    if not root then 
        teleporting = false
        return 
    end
    
    local distance = (deliveryPosition - root.Position).Magnitude
    local speed = math.min(distance / 2, 500)
    local tweenTime = math.max(distance / speed, 0.1)
    
    local tween = TweenService:Create(root, 
        TweenInfo.new(tweenTime, Enum.EasingStyle.Linear), 
        {CFrame = CFrame.new(deliveryPosition)}
    )
    
    tween:Play()
    tween.Completed:Connect(function()
        spawn(function()
            wait(0.1)
            restoreCharacter(character, originalProperties)
            
            if TeleportBtn and TeleportBtn.Parent then
                TeleportBtn.Text = "‚úÖ ARRIVED!"
                wait(1)
                if TeleportBtn and TeleportBtn.Parent then
                    TeleportBtn.Text = "üåÄ FLY TO DELIVERY"
                end
            end
            teleporting = false
        end)
    end)
end

local function instantTeleport()
    if teleporting then return end
    
    if not deliveryPosition then
        BaseTPBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 50)
        BaseTPBtn.Text = "‚ö†Ô∏è SET DELIVERY FIRST"
        spawn(function()
            wait(1)
            if BaseTPBtn and BaseTPBtn.Parent then
                BaseTPBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 100)
                BaseTPBtn.Text = "‚ö° TP TO BASE"
            end
        end)
        return
    end
    
    local character = Player.Character
    if not character then return end
    
    teleporting = true
    TeleportScreen.Enabled = true
    
    local originalProperties = bypassAnticheat(character)
    
    spawn(function()
        local success = pcall(function()
            local root = character:FindFirstChild("HumanoidRootPart")
            if root then
                root.CFrame = CFrame.new(deliveryPosition)
            end
        end)
        
        wait(0.1)
        if originalProperties then
            restoreCharacter(character, originalProperties)
        end
        TeleportScreen.Enabled = false
        teleporting = false
    end)
end

-- NOCLIP SYSTEM
local function toggleNoClip()
    noclipEnabled = not noclipEnabled

    if noclipEnabled then
        NoClipBtn.Text = "üëª NOCLIP: ON"
        NoClipBtn.BackgroundColor3 = Color3.fromRGB(100, 255, 100)
        noclipConnection = RunService.Stepped:Connect(function()
            local character = Player.Character
            if character then
                for _, part in ipairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        NoClipBtn.Text = "üëª NOCLIP: OFF"
        NoClipBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 200)
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        local character = Player.Character
        if character then
            for _, part in ipairs(character:GetDescendants()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    part.CanCollide = true
                end
            end
        end
    end
end

-- DRAG SYSTEM
local function enableDragging(frame)
    local dragging = false
    local dragStart = nil
    local startPos = nil

    local function updateDrag(input)
        if dragging and dragStart and startPos then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            updateDrag(input)
        end
    end)
end

-- EVENTI
SetDeliveryBtn.MouseButton1Click:Connect(function()
    local character = Player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        deliveryPosition = character.HumanoidRootPart.Position + Vector3.new(5, 0, 0)
        SetDeliveryBtn.BackgroundColor3 = Color3.fromRGB(100, 255, 100)
        SetDeliveryBtn.Text = "‚úÖ DELIVERY SET!"
        spawn(function()
            wait(1)
            if SetDeliveryBtn and SetDeliveryBtn.Parent then
                SetDeliveryBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
                SetDeliveryBtn.Text = "üìç SET DELIVERY POINT"
            end
        end)
    end
end)

TeleportBtn.MouseButton1Click:Connect(flyToDelivery)
BaseTPBtn.MouseButton1Click:Connect(instantTeleport)
NoClipBtn.MouseButton1Click:Connect(toggleNoClip)

MinimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.new(0, 350, 0, 35) or UDim2.new(0, 350, 0, 200)
    TweenService:Create(MainFrame, TweenInfo.new(0.3), {Size = targetSize}):Play()
    MinimizeBtn.Text = isMinimized and "+" or "‚àí"
    Content.Visible = not isMinimized
end)

CloseBtn.MouseButton1Click:Connect(function()
    if noclipConnection then 
        noclipConnection:Disconnect() 
        noclipConnection = nil
    end
    teleporting = false
    TweenService:Create(MainFrame, TweenInfo.new(0.3), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    }):Play()
    spawn(function()
        wait(0.3)
        if ScreenGui and ScreenGui.Parent then
            ScreenGui:Destroy()
        end
        if TeleportScreen and TeleportScreen.Parent then
            TeleportScreen:Destroy()
        end
    end)
end)

-- Enable dragging
enableDragging(MainFrame)

print("üß† Rubba Brainrot PRO - Sistema Perfetto Caricato!")
print("GUI should now be visible and working!")
