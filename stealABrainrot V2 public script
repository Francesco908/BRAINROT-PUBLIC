-- SIGMA HUB v2.2 - MOD by Copilot Chat - Modified with Persistent Speed & Amber UI

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- Vars
local deliveryPosition = nil
local isDragging = false
local isMinimized = false
local noclipEnabled = false
local noclipConnection = nil
local teleporting = false
local speedEnabled = false
local speedConnection = nil
local invisEnabled = false

if PlayerGui:FindFirstChild("SigmaHub") then
    PlayerGui.SigmaHub:Destroy()
end

-- Teleport Screen
local TeleportScreen = Instance.new("ScreenGui")
TeleportScreen.Name = "TeleportScreen"
TeleportScreen.DisplayOrder = 999999999
TeleportScreen.IgnoreGuiInset = true
TeleportScreen.Enabled = false
TeleportScreen.Parent = PlayerGui

local BlackScreen = Instance.new("Frame")
BlackScreen.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
BlackScreen.BorderSizePixel = 0
BlackScreen.Size = UDim2.new(1, 0, 1, 0)
BlackScreen.Parent = TeleportScreen

local TeleportText = Instance.new("TextLabel")
TeleportText.BackgroundTransparency = 1
TeleportText.Position = UDim2.new(0, 0, 0.4, 0)
TeleportText.Size = UDim2.new(1, 0, 0.2, 0)
TeleportText.Font = Enum.Font.GothamBold
TeleportText.Text = "TELEPORTING..."
TeleportText.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportText.TextSize = 32
TeleportText.TextScaled = true
TeleportText.Parent = TeleportScreen

-- BYPASS LOGIC
local function bypassAnticheat(character)
    if not character then return false end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not humanoid or not rootPart then return false end
    pcall(function()
        rootPart.Anchored = true
        humanoid.PlatformStand = true
        humanoid.Sit = true
        humanoid.WalkSpeed = 0
        humanoid.JumpPower = 0
        humanoid.AutoRotate = false
        for _,obj in pairs(rootPart:GetChildren()) do
            if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
        end
        local bv = Instance.new("BodyVelocity")
        bv.MaxForce = Vector3.new(1e8, 1e8, 1e8)
        bv.Velocity = Vector3.new(0, 0, 0)
        bv.Parent = rootPart
        local bg = Instance.new("BodyGyro")
        bg.MaxTorque = Vector3.new(1e8,1e8,1e8)
        bg.CFrame = rootPart.CFrame
        bg.Parent = rootPart
    end)
    return true
end

local function restoreCharacter(character)
    if not character then return end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    pcall(function()
        if rootPart then
            rootPart.Anchored = false
            for _,obj in pairs(rootPart:GetChildren()) do
                if obj:IsA("BodyVelocity") or obj:IsA("BodyGyro") then obj:Destroy() end
            end
        end
        if humanoid then
            humanoid.PlatformStand = false
            humanoid.Sit = false
            -- Don't reset speed if speed boost is enabled
            if not speedEnabled then
                humanoid.WalkSpeed = 16
            else
                humanoid.WalkSpeed = 27.2
            end
            humanoid.JumpPower = 50
            humanoid.AutoRotate = true
        end
    end)
end

local function findNearestPlot()
    local character = Player.Character
    if not character then return nil end
    local rootPart = character:FindFirstChild("HumanoidRootPart")
    if not rootPart then return nil end
    local nearestPlot = nil
    local shortestDistance = math.huge
    for _, obj in pairs(Workspace:GetChildren()) do
        if obj.Name:lower():find("plot") then
            local basePart = obj:FindFirstChildOfClass("BasePart")
            if basePart then
                local distance = (rootPart.Position - basePart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    nearestPlot = basePart.Position
                end
            end
        end
    end
    return nearestPlot
end

-- UI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "SigmaHub"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.BackgroundTransparency = 0
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -190)
MainFrame.Size = UDim2.new(0, 350, 0, 380)
MainFrame.Active = true
MainFrame.ClipsDescendants = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 16)
MainCorner.Parent = MainFrame

local Border = Instance.new("UIStroke")
Border.Color = Color3.fromRGB(255, 194, 0)  -- Amber border
Border.Thickness = 2
Border.Transparency = 0.2
Border.Parent = MainFrame

-- Header
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Header.BorderSizePixel = 0
Header.Size = UDim2.new(1, 0, 0, 40)
Header.Active = true

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 16)
HeaderCorner.Parent = Header

local Title = Instance.new("TextLabel")
Title.Parent = Header
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 20, 0, 0)
Title.Size = UDim2.new(1, -100, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "⚡ SIGMA HUB"
Title.TextColor3 = Color3.fromRGB(255, 194, 0)  -- Amber text
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left

local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Parent = Header
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 194, 0)  -- Amber background
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Position = UDim2.new(1, -70, 0.5, -12)
MinimizeBtn.Size = UDim2.new(0, 24, 0, 24)
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.Text = "−"
MinimizeBtn.TextColor3 = Color3.fromRGB(0, 0, 0)  -- Black text
MinimizeBtn.TextSize = 18
local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 6)
MinCorner.Parent = MinimizeBtn

local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = Header
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 194, 0)  -- Amber background
CloseBtn.BorderSizePixel = 0
CloseBtn.Position = UDim2.new(1, -40, 0.5, -12)
CloseBtn.Size = UDim2.new(0, 24, 0, 24)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "×"
CloseBtn.TextColor3 = Color3.fromRGB(0, 0, 0)  -- Black text
CloseBtn.TextSize = 16
local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseBtn

-- Content area
local Content = Instance.new("Frame")
Content.Parent = MainFrame
Content.BackgroundTransparency = 1
Content.Position = UDim2.new(0, 0, 0, 45)
Content.Size = UDim2.new(1, 0, 1, -45)

-- Button factory (amber background, black text)
local function createModernButton(parent, position, size, text, icon)
    local button = Instance.new("TextButton")
    button.Parent = parent
    button.BackgroundColor3 = Color3.fromRGB(255, 194, 0)  -- Amber background
    button.BorderSizePixel = 0
    button.Position = position
    button.Size = size
    button.Font = Enum.Font.GothamBold
    button.Text = icon .. " " .. text
    button.TextColor3 = Color3.fromRGB(0, 0, 0)  -- Black text
    button.TextSize = 14
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = button
    return button
end

-- Bottoni
local SetDeliveryBtn = createModernButton(Content, UDim2.new(0.05, 0, 0.03, 0), UDim2.new(0.9, 0, 0, 32), "SET POSITION", "📍")
local TeleportBtn   = createModernButton(Content, UDim2.new(0.05, 0, 0.13, 0), UDim2.new(0.9, 0, 0, 32), "FLY TO POSITION", "🌀")
local ForwardBtn    = createModernButton(Content, UDim2.new(0.05, 0, 0.23, 0), UDim2.new(0.9, 0, 0, 32), "TP FORWARD (bypass)", "➡️")
local NearestBaseBtn= createModernButton(Content, UDim2.new(0.05, 0, 0.33, 0), UDim2.new(0.9, 0, 0, 32), "NEAREST PLOT", "🎯")
local NoClipBtn     = createModernButton(Content, UDim2.new(0.05, 0, 0.43, 0), UDim2.new(0.9, 0, 0, 32), "NOCLIP: OFF", "👻")
local SpeedBtn      = createModernButton(Content, UDim2.new(0.05, 0, 0.53, 0), UDim2.new(0.9, 0, 0, 32), "SPEED BOOST: OFF", "⚡")
local InvisBtn      = createModernButton(Content, UDim2.new(0.05, 0, 0.63, 0), UDim2.new(0.9, 0, 0, 32), "INVISIBILITY: OFF", "👁️")
local BaseTPBtn     = createModernButton(Content, UDim2.new(0.05, 0, 0.73, 0), UDim2.new(0.9, 0, 0, 32), "INSTANT TP", "✨")

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Parent = Content
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0.05, 0, 0.85, 0)
StatusLabel.Size = UDim2.new(0.9, 0, 0, 25)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Ready to teleport!"
StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)  -- Amber text
StatusLabel.TextSize = 11
StatusLabel.TextXAlignment = Enum.TextXAlignment.Center

-- Teleport functions
local function flyToDelivery()
    if teleporting then return end
    if not deliveryPosition then
        StatusLabel.Text = "⚠️ Set a position first!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 193, 7)
        return
    end
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    teleporting = true
    StatusLabel.Text = "🚀 Flying to position..."
    StatusLabel.TextColor3 = Color3.fromRGB(0, 128, 255)
    if not bypassAnticheat(character) then
        teleporting = false
        return
    end
    local targetCFrame = CFrame.new(deliveryPosition)
    local tweenInfo = TweenInfo.new(1.5, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut)
    local tween = TweenService:Create(rootPart, tweenInfo, {CFrame = targetCFrame})
    tween:Play()
    tween.Completed:Connect(function()
        restoreCharacter(character)
        StatusLabel.Text = "✅ Arrived successfully!"
        StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
        spawn(function()
            wait(3)
            if StatusLabel and StatusLabel.Parent then
                StatusLabel.Text = "Ready to teleport!"
                StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
            end
            teleporting = false
        end)
    end)
end

local function instantTeleport()
    if teleporting then return end
    if not deliveryPosition then
        StatusLabel.Text = "⚠️ Set a position first!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 193, 7)
        return
    end
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    teleporting = true
    TeleportScreen.Enabled = true
    StatusLabel.Text = "⏳ Instant teleporting..."
    StatusLabel.TextColor3 = Color3.fromRGB(255,215,0)
    spawn(function()
        bypassAnticheat(character)
        wait(1)
        if rootPart and rootPart.Parent then
            rootPart.CFrame = CFrame.new(deliveryPosition)
        end
        wait(1)
        TeleportScreen.Enabled = false
        restoreCharacter(character)
        StatusLabel.Text = "✅ Teleported instantly!"
        StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
        wait(3)
        if StatusLabel and StatusLabel.Parent then
            StatusLabel.Text = "Ready to teleport!"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
        end
        teleporting = false
    end)
end

local function teleportToNearestPlot()
    if teleporting then return end
    local plotPosition = findNearestPlot()
    if not plotPosition then
        StatusLabel.Text = "⚠️ No plots found nearby!"
        StatusLabel.TextColor3 = Color3.fromRGB(255,0,255)
        return
    end
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    teleporting = true
    StatusLabel.Text = "🎯 Finding nearest plot..."
    StatusLabel.TextColor3 = Color3.fromRGB(255,0,255)
    bypassAnticheat(character)
    spawn(function()
        wait(0.5)
        if rootPart and rootPart.Parent then
            rootPart.CFrame = CFrame.new(plotPosition + Vector3.new(0, 5, 0))
        end
        wait(0.5)
        restoreCharacter(character)
        StatusLabel.Text = "✅ At nearest plot!"
        StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
        wait(3)
        if StatusLabel and StatusLabel.Parent then
            StatusLabel.Text = "Ready to teleport!"
            StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
        end
        teleporting = false
    end)
end

-- TP FORWARD (bypass)
local function tpForward()
    local character = Player.Character
    if not character then return end
    local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
    if not rootPart then return end
    bypassAnticheat(character)
    wait(0.15)
    local cf = rootPart.CFrame
    -- Avanti di 3
    rootPart.CFrame = cf + (cf.LookVector * 3)
    wait(0.3)
    restoreCharacter(character)
    StatusLabel.Text = "✅ TP Forward!"
    StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
    wait(2)
    StatusLabel.Text = "Ready to teleport!"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
end

-- SPEED BOOST (70%) - PERSISTENT VERSION
local function maintainSpeed()
    local character = Player.Character
    if character and speedEnabled then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid and humanoid.WalkSpeed ~= 27.2 then
            humanoid.WalkSpeed = 27.2
        end
    end
end

local function toggleSpeed()
    speedEnabled = not speedEnabled
    local character = Player.Character
    if not character then return end
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    
    if speedEnabled then
        humanoid.WalkSpeed = 27.2
        SpeedBtn.Text = "⚡ SPEED BOOST: ON"
        StatusLabel.Text = "⚡ Speed Boost ON!"
        StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
        -- Start monitoring speed to maintain it
        if speedConnection then speedConnection:Disconnect() end
        speedConnection = RunService.Heartbeat:Connect(maintainSpeed)
    else
        humanoid.WalkSpeed = 16
        SpeedBtn.Text = "⚡ SPEED BOOST: OFF"
        StatusLabel.Text = "Speed boost OFF"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
        -- Stop monitoring speed
        if speedConnection then 
            speedConnection:Disconnect() 
            speedConnection = nil
        end
    end
    wait(2)
    StatusLabel.Text = "Ready to teleport!"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
end

-- INVISIBILITÀ (anti-anticheat)
local function toggleInvis()
    invisEnabled = not invisEnabled
    local character = Player.Character
    if not character then return end
    -- Nasconde ogni parte visibile
    for _,v in pairs(character:GetChildren()) do
        if v:IsA("BasePart") then
            v.LocalTransparencyModifier = invisEnabled and 1 or 0
            v.CanCollide = not invisEnabled
        end
        if v:IsA("Accessory") and v:FindFirstChild("Handle") then
            v.Handle.LocalTransparencyModifier = invisEnabled and 1 or 0
            v.Handle.CanCollide = not invisEnabled
        end
        if v:IsA("BillboardGui") or v:IsA("Decal") then
            v.Enabled = not invisEnabled
        end
    end
    -- Nasconde la testa overhead
    local head = character:FindFirstChild("Head")
    if head then
        for _,c in pairs(head:GetChildren()) do
            if c:IsA("BillboardGui") then c.Enabled = not invisEnabled end
        end
    end
    InvisBtn.Text = invisEnabled and "👁️ INVISIBILITY: ON" or "👁️ INVISIBILITY: OFF"
    StatusLabel.Text = invisEnabled and "👁️ Invisible!" or "👁️ Visible!"
    StatusLabel.TextColor3 = invisEnabled and Color3.fromRGB(0,255,0) or Color3.fromRGB(255, 194, 0)
    wait(2)
    StatusLabel.Text = "Ready to teleport!"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
end

-- NOCLIP
local function toggleNoClip()
    noclipEnabled = not noclipEnabled
    if noclipEnabled then
        NoClipBtn.Text = "👻 NOCLIP: ON"
        StatusLabel.Text = "👻 NoClip activated!"
        StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
        noclipConnection = RunService.Stepped:Connect(function()
            local character = Player.Character
            if character then
                for _, part in pairs(character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        NoClipBtn.Text = "👻 NOCLIP: OFF"
        StatusLabel.Text = "👻 NoClip deactivated!"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        local character = Player.Character
        if character then
            wait(0.1)
            for _, part in pairs(character:GetChildren()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end
    wait(2)
    StatusLabel.Text = "Ready to teleport!"
    StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
end

-- DRAG
local function enableDragging(frame)
    local dragging = false
    local dragStart = nil
    local startPos = nil
    local connection = nil
    local function updateInput(input)
        if dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            connection = UserInputService.InputChanged:Connect(updateInput)
        end
    end)
    Header.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
            if connection then
                connection:Disconnect()
                connection = nil
            end
        end
    end)
end

-- Handle character respawning to maintain speed boost
Player.CharacterAdded:Connect(function(character)
    if speedEnabled then
        -- Wait for humanoid to load
        local humanoid = character:WaitForChild("Humanoid")
        wait(0.5) -- Small delay to ensure everything is loaded
        humanoid.WalkSpeed = 27.2
    end
end)

-- EVENTI
SetDeliveryBtn.MouseButton1Click:Connect(function()
    local character = Player.Character
    if character then
        local rootPart = character:FindFirstChild("HumanoidRootPart") or character:FindFirstChild("Torso")
        if rootPart then
            deliveryPosition = rootPart.Position
            StatusLabel.Text = "✅ Position saved!"
            StatusLabel.TextColor3 = Color3.fromRGB(0,255,0)
            spawn(function()
                wait(2)
                if StatusLabel and StatusLabel.Parent then
                    StatusLabel.Text = "Ready to teleport!"
                    StatusLabel.TextColor3 = Color3.fromRGB(255, 194, 0)
                end
            end)
        end
    end
end)

TeleportBtn.MouseButton1Click:Connect(flyToDelivery)
BaseTPBtn.MouseButton1Click:Connect(instantTeleport)
NearestBaseBtn.MouseButton1Click:Connect(teleportToNearestPlot)
NoClipBtn.MouseButton1Click:Connect(toggleNoClip)
SpeedBtn.MouseButton1Click:Connect(toggleSpeed)
InvisBtn.MouseButton1Click:Connect(toggleInvis)
ForwardBtn.MouseButton1Click:Connect(tpForward)

MinimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.new(0, 350, 0, 40) or UDim2.new(0, 350, 0, 380)
    local tween = TweenService:Create(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Size = targetSize})
    tween:Play()
    MinimizeBtn.Text = isMinimized and "+" or "−"
    Content.Visible = not isMinimized
end)

CloseBtn.MouseButton1Click:Connect(function()
    if noclipConnection then noclipConnection:Disconnect() noclipConnection = nil end
    if speedConnection then speedConnection:Disconnect() speedConnection = nil end
    teleporting = false
    local tween = TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back), {
        Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0)
    })
    tween:Play()
    tween.Completed:Connect(function()
        if ScreenGui and ScreenGui.Parent then ScreenGui:Destroy() end
        if TeleportScreen and TeleportScreen.Parent then TeleportScreen:Destroy() end
    end)
end)
enableDragging(MainFrame)

-- Startup animation
MainFrame.Size = UDim2.new(0, 0, 0, 0)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
local openTween = TweenService:Create(MainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Size = UDim2.new(0, 350, 0, 380), Position = UDim2.new(0.5, -175, 0.5, -190)
})
openTween:Play()

print("⚡ SIGMA HUB v2.2 - MOD: Persistent speed boost, amber UI, enhanced features!"
