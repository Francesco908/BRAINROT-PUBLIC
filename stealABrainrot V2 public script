-- RUBBA BRAINROT GUI - Sistema Perfetto con NoClip
-- Teleporta SOLO il Model in mano al delivery point (PRIORIT√Ä AL MODEL!)

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- Variabili globali
local deliveryPosition = nil
local currentHeldObject = nil
local currentHeldType = nil
local isDragging = false
local isMinimized = false
local updateConnection = nil
local noclipEnabled = false
local noclipConnection = nil

-- Distruggi GUI esistente
if PlayerGui:FindFirstChild("BrainrotGUI") then
    PlayerGui.BrainrotGUI:Destroy()
end

-- Crea ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BrainrotGUI"
ScreenGui.Parent = PlayerGui
ScreenGui.ResetOnSpawn = false

-- Frame principale
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -125)
MainFrame.Size = UDim2.new(0, 350, 0, 250)
MainFrame.Active = true
MainFrame.ClipsDescendants = true

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local Border = Instance.new("UIStroke")
Border.Color = Color3.fromRGB(70, 130, 255)
Border.Thickness = 2
Border.Transparency = 0.3
Border.Parent = MainFrame

-- Header
local Header = Instance.new("Frame")
Header.Name = "Header"
Header.Parent = MainFrame
Header.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
Header.BorderSizePixel = 0
Header.Size = UDim2.new(1, 0, 0, 35)

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 12)
HeaderCorner.Parent = Header

local HeaderFix = Instance.new("Frame")
HeaderFix.Parent = Header
HeaderFix.BackgroundColor3 = Color3.fromRGB(50, 100, 200)
HeaderFix.BorderSizePixel = 0
HeaderFix.Position = UDim2.new(0, 0, 0.7, 0)
HeaderFix.Size = UDim2.new(1, 0, 0.3, 0)

-- Titolo
local Title = Instance.new("TextLabel")
Title.Parent = Header
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 15, 0, 0)
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "üß† RUBBA BRAINROT PRO"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 14
Title.TextXAlignment = Enum.TextXAlignment.Left

-- Minimizza
local MinimizeBtn = Instance.new("TextButton")
MinimizeBtn.Parent = Header
MinimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
MinimizeBtn.BorderSizePixel = 0
MinimizeBtn.Position = UDim2.new(1, -60, 0.5, -10)
MinimizeBtn.Size = UDim2.new(0, 20, 0, 20)
MinimizeBtn.Font = Enum.Font.GothamBold
MinimizeBtn.Text = "‚àí"
MinimizeBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
MinimizeBtn.TextSize = 16

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 4)
MinCorner.Parent = MinimizeBtn

-- Chiudi
local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = Header
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
CloseBtn.BorderSizePixel = 0
CloseBtn.Position = UDim2.new(1, -35, 0.5, -10)
CloseBtn.Size = UDim2.new(0, 20, 0, 20)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Text = "√ó"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.TextSize = 16

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 4)
CloseCorner.Parent = CloseBtn

-- Contenuto
local Content = Instance.new("Frame")
Content.Parent = MainFrame
Content.BackgroundTransparency = 1
Content.Position = UDim2.new(0, 0, 0, 40)
Content.Size = UDim2.new(1, 0, 1, -40)

-- Pulsante Set Delivery Point
local SetDeliveryBtn = Instance.new("TextButton")
SetDeliveryBtn.Parent = Content
SetDeliveryBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
SetDeliveryBtn.BorderSizePixel = 0
SetDeliveryBtn.Position = UDim2.new(0.05, 0, 0.05, 0)
SetDeliveryBtn.Size = UDim2.new(0.9, 0, 0, 35)
SetDeliveryBtn.Font = Enum.Font.GothamBold
SetDeliveryBtn.Text = "üìç SET DELIVERY POINT"
SetDeliveryBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
SetDeliveryBtn.TextSize = 12

local DeliveryCorner = Instance.new("UICorner")
DeliveryCorner.CornerRadius = UDim.new(0, 8)
DeliveryCorner.Parent = SetDeliveryBtn

-- Pulsante Teleport Brainrot
local TeleportBtn = Instance.new("TextButton")
TeleportBtn.Parent = Content
TeleportBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
TeleportBtn.BorderSizePixel = 0
TeleportBtn.Position = UDim2.new(0.05, 0, 0.22, 0)
TeleportBtn.Size = UDim2.new(0.9, 0, 0, 35)
TeleportBtn.Font = Enum.Font.GothamBold
TeleportBtn.Text = "üåÄ TELEPORT TO DELIVERY"
TeleportBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
TeleportBtn.TextSize = 12

local TeleCorner = Instance.new("UICorner")
TeleCorner.CornerRadius = UDim.new(0, 8)
TeleCorner.Parent = TeleportBtn

-- Pulsante NoClip
local NoClipBtn = Instance.new("TextButton")
NoClipBtn.Parent = Content
NoClipBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 200)
NoClipBtn.BorderSizePixel = 0
NoClipBtn.Position = UDim2.new(0.05, 0, 0.39, 0)
NoClipBtn.Size = UDim2.new(0.9, 0, 0, 35)
NoClipBtn.Font = Enum.Font.GothamBold
NoClipBtn.Text = "üëª NOCLIP: OFF"
NoClipBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
NoClipBtn.TextSize = 12

local NoClipCorner = Instance.new("UICorner")
NoClipCorner.CornerRadius = UDim.new(0, 8)
NoClipCorner.Parent = NoClipBtn

-- Label Detection Status
local DetectionLabel = Instance.new("TextLabel")
DetectionLabel.Parent = Content
DetectionLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
DetectionLabel.BorderSizePixel = 0
DetectionLabel.Position = UDim2.new(0.05, 0, 0.58, 0)
DetectionLabel.Size = UDim2.new(0.9, 0, 0, 30)
DetectionLabel.Font = Enum.Font.GothamBold
DetectionLabel.Text = "üîç DETECTION: Scanning..."
DetectionLabel.TextColor3 = Color3.fromRGB(255, 200, 50)
DetectionLabel.TextSize = 11

local DetectCorner = Instance.new("UICorner")
DetectCorner.CornerRadius = UDim.new(0, 6)
DetectCorner.Parent = DetectionLabel

-- Label Holding
local HoldingLabel = Instance.new("TextLabel")
HoldingLabel.Parent = Content
HoldingLabel.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
HoldingLabel.BorderSizePixel = 0
HoldingLabel.Position = UDim2.new(0.05, 0, 0.75, 0)
HoldingLabel.Size = UDim2.new(0.9, 0, 0, 30)
HoldingLabel.Font = Enum.Font.Gotham
HoldingLabel.Text = "ü§≤ Holding: Nessun oggetto"
HoldingLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
HoldingLabel.TextSize = 11

local HoldCorner = Instance.new("UICorner")
HoldCorner.CornerRadius = UDim.new(0, 6)
HoldCorner.Parent = HoldingLabel

-- SISTEMA DI RILEVAMENTO AVANZATO CON PRIORIT√Ä AL MODEL
local function detectHeldObject()
    DetectionLabel.Text = "üîç DETECTION: Scanning..."
    DetectionLabel.TextColor3 = Color3.fromRGB(255, 200, 50)

    spawn(function()
        wait(2)
        local character = Player.Character
        if not character then 
            DetectionLabel.Text = "üîç DETECTION: No Character"
            DetectionLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            return 
        end

        -- 1. Rileva Model in mano (oggetti custom, come il brainrot)
        for _, child in pairs(character:GetChildren()) do
            if child:IsA("Model") and child.Name ~= character.Name and not child:FindFirstChildOfClass("Humanoid") then
                currentHeldObject = child
                currentHeldType = "Model"
                DetectionLabel.Text = "üîç DETECTION: Model Found!"
                DetectionLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                HoldingLabel.Text = "ü§≤ Holding: " .. child.Name .. " (Model)"
                HoldingLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                return
            end
        end

        -- 2. Rileva Tool equipaggiato SOLO SE NON HAI UN MODEL!
        local tool = character:FindFirstChildOfClass("Tool")
        if tool then
            currentHeldObject = tool
            currentHeldType = "Tool"
            DetectionLabel.Text = "üîç DETECTION: Tool Found!"
            DetectionLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            HoldingLabel.Text = "ü§≤ Holding: " .. tool.Name .. " (Tool)"
            HoldingLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            return
        end

        -- 3. Accessory (tipo cappelli, ecc.)
        for _, child in pairs(character:GetChildren()) do
            if child:IsA("Accessory") then
                currentHeldObject = child
                currentHeldType = "Accessory"
                DetectionLabel.Text = "üîç DETECTION: Accessory Found!"
                DetectionLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                HoldingLabel.Text = "ü§≤ Holding: " .. child.Name .. " (Accessory)"
                HoldingLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                return
            end
        end

        -- 4. Part custom
        for _, child in pairs(character:GetChildren()) do
            if child:IsA("BasePart") and not table.find({"Head", "Torso", "Left Arm", "Right Arm", "Left Leg", "Right Leg", "HumanoidRootPart"}, child.Name) then
                currentHeldObject = child
                currentHeldType = "Part"
                DetectionLabel.Text = "üîç DETECTION: Part Found!"
                DetectionLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                HoldingLabel.Text = "ü§≤ Holding: " .. child.Name .. " (Part)"
                HoldingLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
                return
            end
        end

        -- Nessun oggetto trovato
        currentHeldObject = nil
        currentHeldType = nil
        DetectionLabel.Text = "üîç DETECTION: Nothing Found"
        DetectionLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
        HoldingLabel.Text = "ü§≤ Holding: Nessun oggetto"
        HoldingLabel.TextColor3 = Color3.fromRGB(200, 200, 255)
    end)
end

-- NOCLIP SYSTEM
local function toggleNoClip()
    noclipEnabled = not noclipEnabled

    if noclipEnabled then
        NoClipBtn.Text = "üëª NOCLIP: ON"
        NoClipBtn.BackgroundColor3 = Color3.fromRGB(100, 255, 100)
        noclipConnection = RunService.Stepped:Connect(function()
            local character = Player.Character
            if character then
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        NoClipBtn.Text = "üëª NOCLIP: OFF"
        NoClipBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 200)
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
        local character = Player.Character
        if character then
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    if part.Name ~= "HumanoidRootPart" then
                        part.CanCollide = true
                    end
                end
            end
        end
    end
end

-- TELEPORT SOLO OGGETTO
local function teleportObjectToDelivery()
    if not currentHeldObject then
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
        TeleportBtn.Text = "‚ùå NO OBJECT HELD"
        wait(1)
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
        TeleportBtn.Text = "üåÄ TELEPORT TO DELIVERY"
        return
    end

    if not deliveryPosition then
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(255, 200, 50)
        TeleportBtn.Text = "‚ö†Ô∏è SET DELIVERY FIRST"
        wait(1)
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
        TeleportBtn.Text = "üåÄ TELEPORT TO DELIVERY"
        return
    end

    local success = false

    if currentHeldType == "Model" and currentHeldObject.PrimaryPart then
        currentHeldObject:SetPrimaryPartCFrame(CFrame.new(deliveryPosition))
        success = true
    elseif currentHeldType == "Model" and currentHeldObject:FindFirstChild("Handle") then
        currentHeldObject.Handle.CFrame = CFrame.new(deliveryPosition)
        success = true
    elseif currentHeldType == "Tool" and currentHeldObject:FindFirstChild("Handle") then
        currentHeldObject.Handle.CFrame = CFrame.new(deliveryPosition)
        success = true
    elseif currentHeldType == "Accessory" and currentHeldObject:FindFirstChild("Handle") then
        currentHeldObject.Handle.CFrame = CFrame.new(deliveryPosition)
        success = true
    elseif currentHeldType == "Part" then
        currentHeldObject.CFrame = CFrame.new(deliveryPosition)
        success = true
    end

    if success then
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(100, 255, 100)
        TeleportBtn.Text = "‚úÖ TELEPORTED!"
        wait(1)
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
        TeleportBtn.Text = "üåÄ TELEPORT TO DELIVERY"
    else
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(255, 100, 50)
        TeleportBtn.Text = "‚ùå TELEPORT FAILED"
        wait(1)
        TeleportBtn.BackgroundColor3 = Color3.fromRGB(50, 200, 100)
        TeleportBtn.Text = "üåÄ TELEPORT TO DELIVERY"
    end
end

-- DRAG SYSTEM
local dragging = false
local dragStart = nil
local startPos = nil

Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position

        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                connection:Disconnect()
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end)

-- EVENTI
SetDeliveryBtn.MouseButton1Click:Connect(function()
    local character = Player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        deliveryPosition = character.HumanoidRootPart.Position + Vector3.new(5, 0, 0)
        SetDeliveryBtn.BackgroundColor3 = Color3.fromRGB(100, 255, 100)
        SetDeliveryBtn.Text = "‚úÖ DELIVERY SET!"
        wait(1)
        SetDeliveryBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
        SetDeliveryBtn.Text = "üìç SET DELIVERY POINT"
    end
end)

TeleportBtn.MouseButton1Click:Connect(teleportObjectToDelivery)
NoClipBtn.MouseButton1Click:Connect(toggleNoClip)

MinimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    local targetSize = isMinimized and UDim2.new(0, 350, 0, 35) or UDim2.new(0, 350, 0, 250)
    TweenService:Create(MainFrame, TweenInfo.new(0.3), {Size = targetSize}):Play()
    MinimizeBtn.Text = isMinimized and "+" or "‚àí"
    Content.Visible = not isMinimized
end)

CloseBtn.MouseButton1Click:Connect(function()
    if noclipConnection then noclipConnection:Disconnect() end
    TweenService:Create(MainFrame, TweenInfo.new(0.3), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    }):Play()
    wait(0.3)
    ScreenGui:Destroy()
end)

-- Avvia detection continua ogni 3 secondi
spawn(function()
    while ScreenGui.Parent do
        detectHeldObject()
        wait(3)
    end
end)

print("üß† Rubba Brainrot PRO - Sistema Perfetto Caricato!")
